"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6819],{3905:function(e,t,r){r.d(t,{Zo:function(){return c},kt:function(){return h}});var n=r(7294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},s=Object.keys(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var p=n.createContext({}),l=function(e){var t=n.useContext(p),r=t;return e&&(r="function"==typeof e?e(t):a(a({},t),e)),r},c=function(e){var t=l(e.components);return n.createElement(p.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},b=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,s=e.originalType,p=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),u=l(r),b=o,h=u["".concat(p,".").concat(b)]||u[b]||d[b]||s;return r?n.createElement(h,a(a({ref:t},c),{},{components:r})):n.createElement(h,a({ref:t},c))}));function h(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var s=r.length,a=new Array(s);a[0]=b;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i[u]="string"==typeof e?e:o,a[1]=i;for(var l=2;l<s;l++)a[l]=r[l];return n.createElement.apply(null,a)}return n.createElement.apply(null,r)}b.displayName="MDXCreateElement"},8795:function(e,t,r){r.r(t),r.d(t,{assets:function(){return c},contentTitle:function(){return p},default:function(){return h},frontMatter:function(){return i},metadata:function(){return l},toc:function(){return u}});var n=r(7462),o=r(3366),s=(r(7294),r(3905)),a=["components"],i={slug:"/advanced-kubernetes/container-probes",id:"container-probes",title:"Container Probes"},p="Container Probes",l={unversionedId:"kubernetes2/module-advanced-pods/container-probes",id:"kubernetes2/module-advanced-pods/container-probes",title:"Container Probes",description:"Container probes are recurring, diagnostic procedures, executed by the kubelet on a container. Such a diagnostic procedure may involve executing a process within a container (exec) or making a network request using httpGet or tcpSocket [2].",source:"@site/docs/kubernetes2/module-advanced-pods/21-container-probes.md",sourceDirName:"kubernetes2/module-advanced-pods",slug:"/advanced-kubernetes/container-probes",permalink:"/advanced-kubernetes/container-probes",draft:!1,tags:[],version:"current",sidebarPosition:21,frontMatter:{slug:"/advanced-kubernetes/container-probes",id:"container-probes",title:"Container Probes"},sidebar:"docs",previous:{title:"Pod Health",permalink:"/advanced-kubernetes/pod-health"},next:{title:"Liveness Probe Exercise",permalink:"/advanced-kubernetes/liveness-probe-exercise"}},c={},u=[{value:"Liveness Probe",id:"liveness-probe",level:2},{value:"Readiness Probe",id:"readiness-probe",level:2},{value:"Startup Probes",id:"startup-probes",level:2},{value:"Container Probe Summary",id:"container-probe-summary",level:2},{value:"Sources and Links",id:"sources-and-links",level:2}],d={toc:u},b="wrapper";function h(e){var t=e.components,r=(0,o.Z)(e,a);return(0,s.kt)(b,(0,n.Z)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"container-probes"},"Container Probes"),(0,s.kt)("p",null,"Container probes are recurring, diagnostic procedures, executed by the kubelet on a container. Such a diagnostic procedure may involve executing a process within a container (",(0,s.kt)("inlineCode",{parentName:"p"},"exec"),") or making a network request using ",(0,s.kt)("inlineCode",{parentName:"p"},"httpGet")," or ",(0,s.kt)("inlineCode",{parentName:"p"},"tcpSocket")," ","[2]","."),(0,s.kt)("p",null,"There are ",(0,s.kt)("strong",{parentName:"p"},"three types of Container Probes")," supported by Kubernetes:"),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},"Liveness Probe"),(0,s.kt)("li",{parentName:"ol"},"Readiness Probe"),(0,s.kt)("li",{parentName:"ol"},"Startup Probe")),(0,s.kt)("h2",{id:"liveness-probe"},"Liveness Probe"),(0,s.kt)("p",null,"Experience shows that many applications being operated over extended periods of time stop responding, eventually. This may happen due to various reasons including memory leaks, bugs, etc. In order to bring failed Pods back to life, they must be restarted. The Liveness Probe is designed for exactly this purpose."),(0,s.kt)("p",null,"The liveness probe doesn't wait for the Readiness Probe to succeed."),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"The liveness probe is used to restart failed containers und thus their surrounding Pods"),"."),(0,s.kt)("h2",{id:"readiness-probe"},"Readiness Probe"),(0,s.kt)("p",null,"While the ",(0,s.kt)("strong",{parentName:"p"},"Liveness Probe")," is about ",(0,s.kt)("strong",{parentName:"p"},"restarting")," an unresponsive Pod, the ",(0,s.kt)("strong",{parentName:"p"},"Readiness Probe")," is about ",(0,s.kt)("strong",{parentName:"p"},"controlling incoming traffic from the corresponding Service"),". In other words, ",(0,s.kt)("strong",{parentName:"p"},"a Readiness Probe prevents sending traffic to unresponsive Pods"),"."),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Kubernetes (Kubelet) probes readiness to know whan a container is ready to start accepting traffic ","[1]",".    "),(0,s.kt)("li",{parentName:"ul"},"A Pod is considered ready if all containers are ready."),(0,s.kt)("li",{parentName:"ul"},"If a Pod is not ready then it is removed from corresponding Services by removing the Pod as an Service Endpoint.")),(0,s.kt)("p",null,"So the Readiness Probe causes Kubernetes to wait for some time for the application to become ready. Once ready, the Pod is added as an Endpoint to the corresponding Services and thus traffic is routed to the Pod."),(0,s.kt)("p",null,"In other words, ",(0,s.kt)("strong",{parentName:"p"},"the readiness probe is used to redirect incoming traffic exclusively to Pods being ready to serve requests"),"."),(0,s.kt)("p",null,"Liveness and readiness probes can be used simultaneously. Therefore, it is quite common to configure the Liveness Probe with a higher trashold than the Readiness Probe but using the same command. During startup the Pod is not-ready for a while until it becomes ready or the Liveness Probe finally kills it."),(0,s.kt)("h2",{id:"startup-probes"},"Startup Probes"),(0,s.kt)("p",null,"If, during a Pod startup, a time consuming, mandatory procedure accidentally causes the Liveness Probe to fail, a Startup Probe can be used. Only after the Startup Probe has been successfully passed, Liveness Probes will take over and subsequently be executed on a recurring basis."),(0,s.kt)("p",null,"Use startup probes to know when a container application has started."),(0,s.kt)("p",null,"If a startup probe is configured, it disables liveness and readiness checks until the startup probe succeeds. This ensures that liveness and readiness probes don't prevent  application startup, e.g. in case the application's startup time is relatively long. A long startup procedure may otherwise cause the Kubelet to kill the Pod before the application has been started."),(0,s.kt)("p",null,"After the startup probe has been passed once, the liveness probe takes over. The liveness probe then ensures a faster response to failures, compared to leaving out the startup probe while setting a higher liveness threshold."),(0,s.kt)("p",null,"In many cases, the code is identical for both the Startup and Liveness Probe but with different threshold values in seconds."),(0,s.kt)("h2",{id:"container-probe-summary"},"Container Probe Summary"),(0,s.kt)("p",null,"Often a single probe command is used for Startup, Liveness and Readiness Probes but with different thresholds. The Startup Probe's threshold value is likely to be higher than the Liveness Probe's value which is probably higher than the Readiness Probe's threshold. A lower readiness threshold removes a Pod from the Service's load balancing will providing it a tolerance to recover before the Liveness Probe will restart the Pod which will cause a certain delay on its own."),(0,s.kt)("p",null,"The Startup Probe allows a container startup slowly tightening the monitoring interval with the Liveness Probe once the startup has completed. While Startup and Liveness Probes trigger a Pod restart, the Readiness Probe ensures that requests to a Service aren't routed to non-ready Pods. "),(0,s.kt)("p",null,"Note that restarting a Pod upon a failed probe requires that the Pod's ",(0,s.kt)("inlineCode",{parentName:"p"},"restartPolicy")," is set to ",(0,s.kt)("inlineCode",{parentName:"p"},"Always")," or ",(0,s.kt)("inlineCode",{parentName:"p"},"OnFailure"),". See also section ",(0,s.kt)("a",{parentName:"p",href:"/advanced-kubernetes/pod-restart-policy"},"Restart Policy")),(0,s.kt)("h2",{id:"sources-and-links"},"Sources and Links"),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"Kubernetes Documentation - Tasks - Configure Pods and Containers - Configure Liveness, Readiness and Startup Probes, ",(0,s.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/"},"https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/"))),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"Kubernetes Documentation - Concepts - Workloads - Pods,\nPod Lifecycle, ",(0,s.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/#container-probes"},"https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/#container-probes"))),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"Kubernetes Documentation - Concepts - Workloads - Pods Pod Lifecycle, ",(0,s.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/#restart-policy"},"https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/#restart-policy")))))}h.isMDXComponent=!0}}]);