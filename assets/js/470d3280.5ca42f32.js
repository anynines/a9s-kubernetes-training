"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1721],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return h}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),d=c(n),h=a,m=d["".concat(l,".").concat(h)]||d[h]||u[h]||i;return n?r.createElement(m,s(s({ref:t},p),{},{components:n})):r.createElement(m,s({ref:t},p))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,s=new Array(i);s[0]=d;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:a,s[1]=o;for(var c=2;c<i;c++)s[c]=n[c];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},2315:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return o},contentTitle:function(){return l},metadata:function(){return c},toc:function(){return p},default:function(){return d}});var r=n(7462),a=n(3366),i=(n(7294),n(3905)),s=["components"],o={id:"replicasets",title:"ReplicaSets"},l=void 0,c={unversionedId:"kubernetes/replicaset-and-service/replicasets",id:"kubernetes/replicaset-and-service/replicasets",isDocsHomePage:!1,title:"ReplicaSets",description:"This lesson covers how to run a stateless app in Kubernetes using a Replica Set.",source:"@site/docs/kubernetes/40-replicaset-and-service/20-replicaset.md",sourceDirName:"kubernetes/40-replicaset-and-service",slug:"/kubernetes/replicaset-and-service/replicasets",permalink:"/a9s-kubernetes-training/kubernetes/replicaset-and-service/replicasets",tags:[],version:"current",sidebarPosition:20,frontMatter:{id:"replicasets",title:"ReplicaSets"},sidebar:"docs",previous:{title:"ReplicaSets and Services",permalink:"/a9s-kubernetes-training/kubernetes/replicaset-and-service/introduction"},next:{title:"Services",permalink:"/a9s-kubernetes-training/kubernetes/replicaset-and-service/services"}},p=[{value:"Hello World Web App",id:"hello-world-web-app",children:[]},{value:"Creating the ReplicaSet",id:"creating-the-replicaset",children:[]},{value:"Exercise: Access the Sample Web App from Withing the Cluster",id:"exercise-access-the-sample-web-app-from-withing-the-cluster",children:[]},{value:"Pods and Ports",id:"pods-and-ports",children:[]},{value:"Links",id:"links",children:[]}],u={toc:p};function d(e){var t=e.components,n=(0,a.Z)(e,s);return(0,i.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"This lesson covers how to run a stateless app in Kubernetes using a Replica Set."),(0,i.kt)("h2",{id:"hello-world-web-app"},"Hello World Web App"),(0,i.kt)("p",null,"The sample application can be found on github: ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/fischerjulian/smpl-go-web"},"https://github.com/fischerjulian/smpl-go-web")),(0,i.kt)("h2",{id:"creating-the-replicaset"},"Creating the ReplicaSet"),(0,i.kt)("p",null,"In order to create the ReplicaSet using ",(0,i.kt)("inlineCode",{parentName:"p"},"kubectl")," create a file ",(0,i.kt)("inlineCode",{parentName:"p"},"20-rs-hello-world.yaml"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: apps/v1\nkind: ReplicaSet\nmetadata:\n  name: smpl-go-web-rs\n  labels:\n      app: smpl-go-web-a\n      tier: fontend\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      tier: fontend\n  template:\n    metadata:\n      labels:\n        app: smpl-go-web-a\n        version: "1"\n        tier: fontend  \n    spec:\n      containers:\n        - name: smpl-go-web-c\n          image: "fischerjulian/smpl-go-web:1.0.0"\n          ports:\n            - containerPort: 8080\n')),(0,i.kt)("p",null,"And apply it:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"kubectl apply -f 20-rs-hello-world.yaml\n")),(0,i.kt)("p",null,"This creates a Pod with a single container running a hello world application.\nVerify that the Pods has been created successfully:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"kubectl get pods\n")),(0,i.kt)("p",null,"You should see a running pod names something like ",(0,i.kt)("inlineCode",{parentName:"p"},"smpl-go-web-rs-pkqwd")," where the last part is a random string which will be different for every instance of the replica set."),(0,i.kt)("p",null,"In case you seen the ",(0,i.kt)("em",{parentName:"p"},"status")," ",(0,i.kt)("inlineCode",{parentName:"p"},"ContainerCreating")," you can use:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"kubectl get pods --watch \n")),(0,i.kt)("p",null,"To observe the current Pod state until completion."),(0,i.kt)("p",null,"Now the application is deployed. However, it can only be accessed from within the cluster."),(0,i.kt)("h2",{id:"exercise-access-the-sample-web-app-from-withing-the-cluster"},"Exercise: Access the Sample Web App from Withing the Cluster"),(0,i.kt)("p",null,"A straight forward way to access the web app is to directly access the corresponding Pod:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Run ",(0,i.kt)("inlineCode",{parentName:"li"},"kubectl describe pod smpl-go-web-rs-pkqwd")," (replace ",(0,i.kt)("em",{parentName:"li"},"pkqwd")," with your Pod's suffix) and extract the IP address of the ",(0,i.kt)("inlineCode",{parentName:"li"},"smpl-go-web-rs-pkqwd"),"-Pod, e.g. 100.96.14.17"),(0,i.kt)("li",{parentName:"ul"},"Start a container running a shell as described in one of the previous lessons."),(0,i.kt)("li",{parentName:"ul"},"Inside the interactive container use the wget command to access the Pod, e.g. ",(0,i.kt)("inlineCode",{parentName:"li"},"wget 100.96.14.17:8080"),". You can read the returned file using the cat command: ",(0,i.kt)("inlineCode",{parentName:"li"},"cat index.html"),"."),(0,i.kt)("li",{parentName:"ul"},"Don't forget to delete the interactive busybox Pod after using it: ",(0,i.kt)("inlineCode",{parentName:"li"},"kubectl delete pod busybox"))),(0,i.kt)("p",null,"However, this approach comes with some signficant disadvantages. Possibly the biggest drawback is a client trying to access the app needs to figure out where the Pod is located by obtaining its IP address. This process is also referred to as ",(0,i.kt)("em",{parentName:"p"},"service discovery"),". Once, the IP address is known, the client can access the Pod but what happens if the Pod fails, e.g. caused by the failure or maintenance of the underlying Kubernetes Node (the VM the Pod is running on)? In this case the ReplicaSet will be rescheduled by Kubernetes and most likely receive a different IP address. The resulting ",(0,i.kt)("em",{parentName:"p"},"service discovery"),"-challenge is non-trivial in a dynamic cluster environment."),(0,i.kt)("p",null,"Kubernetes provides the concept of a ",(0,i.kt)("inlineCode",{parentName:"p"},"Service")," enabling a number of ways to deal with ",(0,i.kt)("em",{parentName:"p"},"service discovery"),", gracefully."),(0,i.kt)("h2",{id:"pods-and-ports"},"Pods and Ports"),(0,i.kt)("p",null,"Have you noticed that the container specification of the app contains an explicit port declaration?"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'spec:\n  containers:\n    - name: smpl-go-web-c\n      image: "fischerjulian/smpl-go-web:1.0.0"\n      ports:\n        - containerPort: 8080\n')),(0,i.kt)("p",null,"The Kubernetes documentation says:"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},'"Kubernetes gives every pod its own cluster-private IP address, so you do not need to explicitly create links between pods or map container ports to host ports. This means that containers within a Pod can all reach each other\'s ports on localhost, and all pods in a cluster can see each other without NAT."')),(0,i.kt)("p",null,"By owning a private IP address within your cluster network each Pod can use the entire port range (65.535) among its containers. Obviously, this implies that two containers using a port cannot occupy the same port simultaneously. They may use the same port to communicate but only one container can open it."),(0,i.kt)("h2",{id:"links"},"Links"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Kubernetes Documentation, Concepts, ReplicaSet, ",(0,i.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/concepts/workloads/controllers/replicaset"},"https://kubernetes.io/docs/concepts/workloads/controllers/replicaset")),(0,i.kt)("li",{parentName:"ul"},"Kubernetes v1.12 Documentation, API Reference, ReplicaSet, ",(0,i.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.12/#replicaset-v1-apps"},"https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.12/#replicaset-v1-apps"))))}d.isMDXComponent=!0}}]);