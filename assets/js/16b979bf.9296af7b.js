"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[4391],{3905:function(e,n,t){t.d(n,{Zo:function(){return c},kt:function(){return b}});var o=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,o,a=function(e,n){if(null==e)return{};var t,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var s=o.createContext({}),p=function(e){var n=o.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},c=function(e){var n=p(e.components);return o.createElement(s.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},m=o.forwardRef((function(e,n){var t=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),m=p(t),b=a,d=m["".concat(s,".").concat(b)]||m[b]||u[b]||r;return t?o.createElement(d,l(l({ref:n},c),{},{components:t})):o.createElement(d,l({ref:n},c))}));function b(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var r=t.length,l=new Array(r);l[0]=m;var i={};for(var s in n)hasOwnProperty.call(n,s)&&(i[s]=n[s]);i.originalType=e,i.mdxType="string"==typeof e?e:a,l[1]=i;for(var p=2;p<r;p++)l[p]=t[p];return o.createElement.apply(null,l)}return o.createElement.apply(null,t)}m.displayName="MDXCreateElement"},151:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return i},contentTitle:function(){return s},metadata:function(){return p},toc:function(){return c},default:function(){return m}});var o=t(7462),a=t(3366),r=(t(7294),t(3905)),l=["components"],i={id:"parallel-jobs",title:"Parallel Jobs"},s=void 0,p={unversionedId:"kubernetes/jobs/parallel-jobs",id:"kubernetes/jobs/parallel-jobs",isDocsHomePage:!1,title:"Parallel Jobs",description:"In this lesson you will learn about executing tasks in parallel by running multiple Pods simultaneously.",source:"@site/docs/kubernetes/70-jobs/50-parallel-jobs.md",sourceDirName:"kubernetes/70-jobs",slug:"/kubernetes/jobs/parallel-jobs",permalink:"/a9s-kubernetes-training/kubernetes/jobs/parallel-jobs",tags:[],version:"current",sidebarPosition:50,frontMatter:{id:"parallel-jobs",title:"Parallel Jobs"},sidebar:"docs",previous:{title:"Advanced Job Features",permalink:"/a9s-kubernetes-training/kubernetes/jobs/advanced-jobs"},next:{title:"CronJobs",permalink:"/a9s-kubernetes-training/kubernetes/jobs/cron-jobs"}},c=[{value:"Job Completion Count",id:"job-completion-count",children:[]},{value:"Parallel Job Execution",id:"parallel-job-execution",children:[]}],u={toc:c};function m(e){var n=e.components,t=(0,a.Z)(e,l);return(0,r.kt)("wrapper",(0,o.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"In this lesson you will learn about executing tasks in parallel by running multiple Pods simultaneously."),(0,r.kt)("h2",{id:"job-completion-count"},"Job Completion Count"),(0,r.kt)("p",null,"In the previous example using ",(0,r.kt)("inlineCode",{parentName:"p"},"kubectl get jobs")," you may have noticed the field ",(0,r.kt)("inlineCode",{parentName:"p"},"COMPLETIONS")," whose value was ",(0,r.kt)("inlineCode",{parentName:"p"},"1/1")," in case a Job has been completed successfully. More precisely, the count determines the number of successful Pod executions as part of the Job. In case of a failing Job, the failing Pod has been recreated and the completion count has been reached even though the source code describe the task has been very unreliable."),(0,r.kt)("p",null,"There are tasks requiring more than one iteration to fully accomplish the underlying objective. For this purpose Kubernetes Jobs allow to specify the number of desired completions, e.g. 2 completions by adding ",(0,r.kt)("inlineCode",{parentName:"p"},"completions: 2"),"."),(0,r.kt)("p",null,"Let's give it a try! Create the file ",(0,r.kt)("inlineCode",{parentName:"p"},"60-simple-job-two-completions.yaml"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: batch/v1\nkind: Job\nmetadata:\n  name: one-off-job-two-completions\nspec:\n  completions: 2\n  template:\n    spec:\n      containers:\n      - name: simple-one-off-job-container\n        image: busybox\n        imagePullPolicy: Always\n        command: ["echo"]\n        args:\n        - "I represent a very important maintenance task"\n      restartPolicy: OnFailure\n')),(0,r.kt)("p",null,"And apply it:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"kubectl apply -f 60-simple-job-two-completions.yaml\n")),(0,r.kt)("p",null,"While the Job is running observe its Pods by opening another terminal so you can paste the observation command immediately after executing it. Ideally, you have the command already in your clipboard (CTRL+C):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"kubectl get pods -l job-name=one-off-job-two-completions -w\n")),(0,r.kt)("p",null,"You should see two Pods. If things happen too fast increase the number of completions to gain more observation time."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"NAME                                READY   STATUS            RESTARTS   AGE\none-off-job-two-completions-xzhmh   0/1     Pending             0          0s\none-off-job-two-completions-xzhmh   0/1     Pending             0          0s\none-off-job-two-completions-xzhmh   0/1     ContainerCreating   0          0s\none-off-job-two-completions-xzhmh   0/1     Completed           0          3s\none-off-job-two-completions-pb44m   0/1     Pending             0          0s\none-off-job-two-completions-pb44m   0/1     Pending             0          0s\none-off-job-two-completions-pb44m   0/1     ContainerCreating   0          0s\none-off-job-two-completions-pb44m   0/1     Completed           0          3s\n")),(0,r.kt)("p",null,"A close observation also reveals that ",(0,r.kt)("strong",{parentName:"p"},"the Pods run in sequence"),". This may be desired if the task requires ordinality and the execution sequence matters to the the task outcome. However, if there is no ordinality requirement ",(0,r.kt)("strong",{parentName:"p"},"running the Jobs Pods in sequence is a waste of time"),"."),(0,r.kt)("h2",{id:"parallel-job-execution"},"Parallel Job Execution"),(0,r.kt)("p",null,"Luckily Kubernets supports parallel Job execution out of the box. Changing the Job definition to enable parallelism is as easy as pie by adding a spec attributed ",(0,r.kt)("inlineCode",{parentName:"p"},"parallelism: 2"),"."),(0,r.kt)("p",null,"Create the Job description in file ",(0,r.kt)("inlineCode",{parentName:"p"},"70-simple-job-two-completions-parallel.yaml"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: batch/v1\nkind: Job\nmetadata:\n  name: one-off-job-two-completions-parallel\nspec:\n  completions: 2\n  parallelism: 2\n  template:\n    spec:\n      containers:\n      - name: simple-one-off-job-container\n        image: busybox\n        imagePullPolicy: Always\n        command: ["echo"]\n        args:\n        - "I represent a very important maintenance task"\n      restartPolicy: OnFailure\n')),(0,r.kt)("p",null,"Running the Job:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"kubectl apply -f 70-simple-job-two-completions-parallel.yaml\n")),(0,r.kt)("p",null,"And observing the result:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"kubectl get pods -l job-name=one-off-job-two-completions-parallel -w\n")),(0,r.kt)("p",null,"The output looks similar to:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"NAME                                         READY   STATUS    RESTARTS   AGE\none-off-job-two-completions-parallel-s2j5k   0/1     Pending             0          0s\none-off-job-two-completions-parallel-s2j5k   0/1     Pending             0          0s\none-off-job-two-completions-parallel-qknz4   0/1     Pending             0          0s\none-off-job-two-completions-parallel-qknz4   0/1     Pending             0          0s\none-off-job-two-completions-parallel-s2j5k   0/1     ContainerCreating   0          0s\none-off-job-two-completions-parallel-qknz4   0/1     ContainerCreating   0          0s\none-off-job-two-completions-parallel-s2j5k   0/1     Completed           0          3s\none-off-job-two-completions-parallel-qknz4   0/1     Completed           0          3s\n")),(0,r.kt)("p",null,"Compare the outputs of the ",(0,r.kt)("em",{parentName:"p"},"first non-parallel")," and ",(0,r.kt)("em",{parentName:"p"},"second parallel")," run."),(0,r.kt)("p",null,"The ",(0,r.kt)("em",{parentName:"p"},"first run")," the sequence was: ",(0,r.kt)("inlineCode",{parentName:"p"},"Pending, Pending, ContainerCreating, Completed, ContainerCreating, Completed")," which implies sequential execution."),(0,r.kt)("p",null,"The ",(0,r.kt)("em",{parentName:"p"},"second run")," shows parallel execution with the sequence: ",(0,r.kt)("inlineCode",{parentName:"p"},"Pending, Pending, ContainerCreating, ContainerCreating, Completed, Completed"),"."),(0,r.kt)("p",null,"As you can see ",(0,r.kt)("strong",{parentName:"p"},"it is fairly easy to define iterative, parallel Jobs using Kubernetes"),"."))}m.isMDXComponent=!0}}]);