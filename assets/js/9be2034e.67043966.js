"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[5075],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return h}});var r=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},u="mdxType",g={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=c(n),d=i,h=u["".concat(l,".").concat(d)]||u[d]||g[d]||a;return n?r.createElement(h,o(o({ref:t},p),{},{components:n})):r.createElement(h,o({ref:t},p))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,o=new Array(a);o[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[u]="string"==typeof e?e:i,o[1]=s;for(var c=2;c<a;c++)o[c]=n[c];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},5389:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return l},default:function(){return h},frontMatter:function(){return s},metadata:function(){return c},toc:function(){return u}});var r=n(7462),i=n(3366),a=(n(7294),n(3905)),o=["components"],s={id:"streaming-replication",title:"PostgreSQL Streaming Replication"},l=void 0,c={unversionedId:"postgresql/postgresql-theory/streaming-replication",id:"postgresql/postgresql-theory/streaming-replication",title:"PostgreSQL Streaming Replication",description:"Before setting up an asynchronously replicating PostgreSQL it makes sense to understand which replication method is used and - roughly - how it works.",source:"@site/docs/postgresql/20-postgresql-theory/10-streaming-replication.md",sourceDirName:"postgresql/20-postgresql-theory",slug:"/postgresql/postgresql-theory/streaming-replication",permalink:"/postgresql/postgresql-theory/streaming-replication",draft:!1,tags:[],version:"current",sidebarPosition:10,frontMatter:{id:"streaming-replication",title:"PostgreSQL Streaming Replication"},sidebar:"docs",previous:{title:"Replication Outline",permalink:"/postgresql/postgresql-theory/replication-outline"},next:{title:"Setting up Streaming Replication",permalink:"/postgresql/postgresql-theory/setting-up-streaming-replication"}},p={},u=[{value:"Write-Ahead Logging (WAL)",id:"write-ahead-logging-wal",level:2},{value:"Asynchronous Replication using Log Shipping",id:"asynchronous-replication-using-log-shipping",level:2},{value:"Replication using Streaming Replication",id:"replication-using-streaming-replication",level:2},{value:"Summary",id:"summary",level:2},{value:"Links",id:"links",level:2}],g={toc:u},d="wrapper";function h(e){var t=e.components,n=(0,i.Z)(e,o);return(0,a.kt)(d,(0,r.Z)({},g,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Before setting up an asynchronously replicating PostgreSQL it makes sense to understand which replication method is used and - roughly - how it works."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"The replication method that will be used is WAL based streaming replication"),", but before we jump to this conclusion a brief dive into WAL and Log Shipping will help to understand the choice."),(0,a.kt)("h2",{id:"write-ahead-logging-wal"},"Write-Ahead Logging (WAL)"),(0,a.kt)("p",null,"Write-Ahead Logging (WAL) is a widely adapted methodology to ensure data integrity while speeding up transactions ","[2]",". This is achieved by writing data changes to an append-only store. Whenever data is changed a WAL file is updated and changes are flushed to the disk. This is much faster than touching and committing several data files to disk as it reduces the number of disk operations.\nIn case the database server fails before data files have been updated, data can be recovered from the WAL files which contain the missing data changes that have been cached but not applied to the data files, yet."),(0,a.kt)("p",null,"As WAL files contain the changes to be applied to data files, they qualify for additional purposes including point in time recovery (PITR) ","[3]"," and replication."),(0,a.kt)("p",null,"There are at least two different methods to use WALs to accomplish replication: Log Shipping and Streaming Replication."),(0,a.kt)("h2",{id:"asynchronous-replication-using-log-shipping"},"Asynchronous Replication using Log Shipping"),(0,a.kt)("p",null,"In PostgreSQL the write-ahead log is data structure distributed across multiple WAL files of a defined capacity, e.g. 16 MB. One way to establish a replication of a database is to transfer the WAL files to a secondary. This process is called ",(0,a.kt)("strong",{parentName:"p"},"Log Shipping"),"."),(0,a.kt)("p",null,"This method is asynchronous by design as WAL files can only be transferred after a transaction has been committed."),(0,a.kt)("p",null,"The resulting replication lag - data that has been committed but not yet transferred to secondary servers - can be lost in the event of a failing primary server. Streaming replication is a related alternative that can help to further reduce this risk of data loss."),(0,a.kt)("h2",{id:"replication-using-streaming-replication"},"Replication using Streaming Replication"),(0,a.kt)("p",null,"Instead of waiting for a WAL file to be filled and thus ready to be shipped, streaming replication allows secondaries to connect to the primary server and retrieve WAL records continuously ","[1]",". ",(0,a.kt)("strong",{parentName:"p"},"With streaming replication WAL records are distributed quicker. Therefore, the replication lag as well as the amount of data at risk decreases"),"."),(0,a.kt)("h2",{id:"summary"},"Summary"),(0,a.kt)("p",null,"With PostgreSQL asynchronous replication can be implemented using streaming replication of WAL records. This reduces the replication leg to a minimum."),(0,a.kt)("h2",{id:"links"},"Links"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"PostgreSQL 12 Documentation - Streaming Replication, ",(0,a.kt)("a",{parentName:"li",href:"https://www.postgresql.org/docs/12/warm-standby.html#STREAMING-REPLICATION"},"https://www.postgresql.org/docs/12/warm-standby.html#STREAMING-REPLICATION")),(0,a.kt)("li",{parentName:"ol"},"PostgreSQL 12 Documentation - Write-Ahead Logging (WAL), ",(0,a.kt)("a",{parentName:"li",href:"https://www.postgresql.org/docs/12/wal-intro.html"},"https://www.postgresql.org/docs/12/wal-intro.html")),(0,a.kt)("li",{parentName:"ol"},"PostgreSQL 12 Documentation - Continuous Archiving and Point-in-Time Recovery (PITR), ",(0,a.kt)("a",{parentName:"li",href:"https://www.postgresql.org/docs/12/continuous-archiving.html"},"https://www.postgresql.org/docs/12/continuous-archiving.html")),(0,a.kt)("li",{parentName:"ol"},"PostgreSQL 12 Documentation - Log-Shipping Standby Servers, ",(0,a.kt)("a",{parentName:"li",href:"https://www.postgresql.org/docs/12/warm-standby.html"},"https://www.postgresql.org/docs/12/warm-standby.html"))))}h.isMDXComponent=!0}}]);