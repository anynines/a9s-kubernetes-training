<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.58">
<title data-react-helmet="true">Headless Service | Kubernetes Training</title><meta data-react-helmet="true" property="og:image" content="https://anynines.github.io/img/logo.svg"><meta data-react-helmet="true" property="twitter:image" content="https://anynines.github.io/img/logo.svg"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for Kubernetes Training"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Headless Service | Kubernetes Training"><meta data-react-helmet="true" name="description" content="Once you have create the PostgreSQL StatefulSet you may want to access it with an application. The next lessons will therefore evolve towards application access, step by step."><meta data-react-helmet="true" property="og:description" content="Once you have create the PostgreSQL StatefulSet you may want to access it with an application. The next lessons will therefore evolve towards application access, step by step."><meta data-react-helmet="true" property="og:url" content="https://anynines.github.io/kubernetes/80-stateful-sets/stateful-set-headless-service"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://anynines.github.io/kubernetes/80-stateful-sets/stateful-set-headless-service"><link rel="stylesheet" href="/styles.3242ed13.css">
<link rel="preload" href="/styles.3e1a9644.js" as="script">
<link rel="preload" href="/runtime~main.4b91e377.js" as="script">
<link rel="preload" href="/main.43f40134.js" as="script">
<link rel="preload" href="/1.040ff6b2.js" as="script">
<link rel="preload" href="/2.9decab9e.js" as="script">
<link rel="preload" href="/62.da6d2fa3.js" as="script">
<link rel="preload" href="/61.482bd80b.js" as="script">
<link rel="preload" href="/ec1ed54d.cede18ae.js" as="script">
<link rel="preload" href="/17896441.6d66ffd8.js" as="script">
<link rel="preload" href="/0d1ece02.986df59f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/training-overview"><img class="navbar__logo" src="/img/logo.svg" alt="anynines"><strong class="navbar__title">Kubernetes Training</strong></a><a class="navbar__item navbar__link" href="/containerization/container-overview">Container Training</a><a class="navbar__item navbar__link" href="/kubernetes/kubernetes-overview">Kubernetes Training</a><a class="navbar__item navbar__link" href="/postgresql/postgresql-overview">PostgreSQL on Kubernetes</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/anynines" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><a href="https://paas.anynines.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">anynines PaaS</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/training-overview"><img class="navbar__logo" src="/img/logo.svg" alt="anynines"><strong class="navbar__title">Kubernetes Training</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/containerization/container-overview">Container Training</a></li><li class="menu__list-item"><a class="menu__link" href="/kubernetes/kubernetes-overview">Kubernetes Training</a></li><li class="menu__list-item"><a class="menu__link" href="/postgresql/postgresql-overview">PostgreSQL on Kubernetes</a></li><li class="menu__list-item"><a href="https://github.com/anynines" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a href="https://paas.anynines.com" target="_blank" rel="noopener noreferrer" class="menu__link">anynines PaaS</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp" role="complementary"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLinkText_2sSe">Introduction</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/training-overview">Kubernetes Training Overview</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_2sSe">Containerization</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/containerization/container-overview">Container Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/containerization/container-intro">Containers Basics</a></li><li class="menu__list-item"><a class="menu__link menuLinkText_2sSe" tabindex="0">Docker</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docker/installation">Docker Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docker/docker-basics">Docker Basics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docker/creating-images">Creating Container Images</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docker/simple-web-app">Containerizing a Simple Web App</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docker/publish-image">Publishing a Container Image</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docker/container-workflow">The Container Workflow</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docker/docker-cheatsheet">Docker Cheat Sheet</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_2sSe">Kubernetes</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/kubernetes-overview">Kubernetes Overview</a></li><li class="menu__list-item"><a class="menu__link menuLinkText_2sSe" tabindex="0">Basics</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/10-basics/kubectl">kubectl Basics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/10-basics/namespaces">Namespaces</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/10-basics/container-shell">Container Shell Access</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_2sSe" tabindex="0">Pods</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/20-pods/introduction">Pods</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_2sSe" tabindex="0">ReplicaSets and Services</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/40-replicaset-and-service/introduction">ReplicaSets and Services</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/40-replicaset-and-service/replicasets">ReplicaSets</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/40-replicaset-and-service/services">Services</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/40-replicaset-and-service/ingress">Ingress</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/40-replicaset-and-service/tidyup">Tyding Up</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_2sSe" tabindex="0">Deployments</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/50-deployments/deployments">Deployments</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_2sSe" tabindex="0">ConfigMaps and Secrets</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/60-configmaps-and-secrets/configmaps-and-secrets">ConfigMaps and Secrets</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/60-configmaps-and-secrets/configmaps">ConfigMaps</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/60-configmaps-and-secrets/exercise-explanation">Exercise Explanation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/60-configmaps-and-secrets/configmaps-volume-mounts">ConfigMap Volume Mounts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/60-configmaps-and-secrets/secrets">Secrets</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/60-configmaps-and-secrets/secrets-exercise-explanation">Secrets Exercise Explanation</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_2sSe" tabindex="0">Jobs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/70-jobs/jobs">Jobs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/70-jobs/advanced-jobs">Advanced Job Features</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/70-jobs/parallel-jobs">Parallel Jobs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/70-jobs/cron-jobs">CronJobs</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_2sSe" tabindex="0">StatefulSets</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/80-stateful-sets/persistent-volumes">Persistent Volumes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/80-stateful-sets/persistent-volumes-exercise">Persistent Volumes Excercise</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/80-stateful-sets/stateful-sets">StatefulSets</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/80-stateful-sets/stateful-set-postgresql">PostgreSQL StatefulSet</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/kubernetes/80-stateful-sets/stateful-set-headless-service">Headless Service</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/80-stateful-sets/stateful-set-vs-replicasets">StatefulSet vs. ReplicaSets</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/80-stateful-sets/stateful-set-psql-access-to-postgresql">PSQL Access to PostgreSQL</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/80-stateful-sets/stateful-set-application-access">Application Access to a StatefulSet</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/80-stateful-sets/stateful-set-conclusions">Conclusions</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_2sSe">PostgreSQL on Kubernetes</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/postgresql-overview">Overview</a></li><li class="menu__list-item"><a class="menu__link menuLinkText_2sSe" tabindex="0">PostgreSQL Replication</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/20-postgresql-theory/why-use-replication">Why use Replication?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/20-postgresql-theory/replication-outline">Replication Outline</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/20-postgresql-theory/streaming-replication">PostgreSQL Streaming Replication</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/20-postgresql-theory/setting-up-streaming-replication">Setting up Streaming Replication</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_2sSe" tabindex="0">StatefulSet with Replication</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/30-stateful-sets-revisited/stateful-sets-revisited">StatefulSets Revisited</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/40-building-the-pg-stateful-set/pg-service-primary">Service to Connnect to the Primary</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/40-building-the-pg-stateful-set/streaming-replication-configmaps">Streaming Replication ConfigMaps</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/40-building-the-pg-stateful-set/streaming-replication-sfs-init">Initializing the StatefulSet</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/40-building-the-pg-stateful-set/replication-user">Creating a Replication User</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/40-building-the-pg-stateful-set/verify-replication">Verifying the Replication</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/postgresql-outro">Outro</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="container padding-vert--lg docItemWrapper_1cc7"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Headless Service</h1></header><div class="markdown"><p>Once you have create the PostgreSQL StatefulSet you may want to access it with an application. The next lessons will therefore evolve towards application access, step by step.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="the-statefulset-and-its-headless-service"></a>The StatefulSet and its Headless Service<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-statefulset-and-its-headless-service" title="Direct link to heading">#</a></h2><p>In the previous chapter you have learned that a StatefulSet has a stable network identity. As mentioned before, the PostgreSQL StatefulSet will be accessed by an application. As applications may change during version updates or being rescheduled in the Cluster, so could be Pods of a StatefulSet. With both the application Deployments and the StatefulSet being fast moving targets, it is the StatefulSet&#x27;s headless Service providing a stable entry point for the application to reach out to the PostgreSQL StatefulSet.</p><p>Have a look at what you have created in the previous lesson:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">kubectl describe </span><span class="token function" style="color:rgb(130, 170, 255)">service</span><span class="token plain"> postgresql-svc</span></div></div></div></div></div><p>Shows that the headless Service <code>postgresql-svc</code> has the label <code>Labels: app=postgresql-a</code>.</p><p>And:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">kubectl describe </span><span class="token function" style="color:rgb(130, 170, 255)">service</span><span class="token plain"> postgresql-svc</span></div></div></div></div></div><p>Produces an output similar to:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">Name:              postgresql-svc</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Namespace:         k8s-training</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Labels:            </span><span class="token assign-left variable" style="color:rgb(214, 222, 235)">app</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">postgresql-a</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Annotations:       Selector:  </span><span class="token assign-left variable" style="color:rgb(214, 222, 235)">app</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">postgresql-a</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Type:              ClusterIP</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">IP:                None</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Port:              postgresql-port  </span><span class="token number" style="color:rgb(247, 140, 108)">5432</span><span class="token plain">/TCP</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">TargetPort:        </span><span class="token number" style="color:rgb(247, 140, 108)">5432</span><span class="token plain">/TCP</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Endpoints:         </span><span class="token number" style="color:rgb(247, 140, 108)">172.17</span><span class="token plain">.0.5:5432</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Session Affinity:  None</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Events:            </span><span class="token operator" style="color:rgb(127, 219, 202)">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:rgb(127, 219, 202)">&gt;</span></div></div></div></div></div><p>Which shows <code>Annotations: Selector:  app=postgresql-a</code> indicating that the Service is connected to the StatefulSet through the Label <code>app=postgresql-a</code>. You can see that in the <code>Endpoints: 172.17.0.5:5432</code> line which refers to the Pod <code>postgresql-sfs-0</code> of the StatefulSet <code>postgresql-sfs</code>.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">kubectl describe pod kubectl describe postgresql-sfs-0</span></div></div></div></div></div><p>The output shows that the Pod <code>postgresql-sfs-0</code> has the <code>IP: 172.17.0.5</code> which means that the Pod is set as the endpoint of the headless Service.</p><p>This means that a DNS entry will be created pointing directly to the the Pods associated with the Service.</p><p>Verify this by executing:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">kubectl describe </span><span class="token function" style="color:rgb(130, 170, 255)">service</span><span class="token plain"> postgresql-svc</span></div></div></div></div></div><p>Which reveals that the headless Service <code>postgresql-svc</code> has the label <code>Labels: app=postgresql-a</code>.</p><p>And:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">kubectl describe </span><span class="token function" style="color:rgb(130, 170, 255)">service</span><span class="token plain"> postgresql-svc</span></div></div></div></div></div><p>Produces an output similar to:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">Name:              postgresql-svc</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Namespace:         k8s-training</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Labels:            </span><span class="token assign-left variable" style="color:rgb(214, 222, 235)">app</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">postgresql-a</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Annotations:       Selector:  </span><span class="token assign-left variable" style="color:rgb(214, 222, 235)">app</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">postgresql-a</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Type:              ClusterIP</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">IP:                None</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Port:              postgresql-port  </span><span class="token number" style="color:rgb(247, 140, 108)">5432</span><span class="token plain">/TCP</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">TargetPort:        </span><span class="token number" style="color:rgb(247, 140, 108)">5432</span><span class="token plain">/TCP</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Endpoints:         </span><span class="token number" style="color:rgb(247, 140, 108)">172.17</span><span class="token plain">.0.5:5432</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Session Affinity:  None</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Events:            </span><span class="token operator" style="color:rgb(127, 219, 202)">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:rgb(127, 219, 202)">&gt;</span></div></div></div></div></div><p>This shows <code>Annotations: Selector:  app=postgresql-a</code> indicating that the Service is connected to the StatefulSet through the Label <code>app=postgresql-a</code>. You can see that in the <code>Endpoints: 172.17.0.5:5432</code> line which refers to the Pod <code>postgresql-sfs-0</code> of the StatefulSet <code>postgresql-sfs</code>.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">kubectl describe pod kubectl describe postgresql-sfs-0</span></div></div></div></div></div><p>The output shows that the Pod <code>postgresql-sfs-0</code> has the <code>IP: 172.17.0.5</code> which means that the Pod is set as the endpoint of the headless Service.</p><p>Along with the headless Service <code>postgresql-svc</code> Kubernetes will create a cluster-internal DNS entry: <code>postgresql-svc.k8s-training.svc.cluster.local</code>. </p><p><strong>Go and see yourself!</strong></p><p>First, get inside the cluster by launching a utility Pod:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">kubectl run -i --tty nspct --image</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">fischerjulian/nspct --restart</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">Never -- </span><span class="token function" style="color:rgb(130, 170, 255)">bash</span></div></div></div></div></div><p>The <code>nspct</code> image provides a few handy tools such as <code>nslookup</code> - a utility to query nameservers.</p><p>Inside of the <code>nspct</code> Pod check wether the resolver can resolve the service url:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token function" style="color:rgb(130, 170, 255)">nslookup</span><span class="token plain"> postgresql-svc.k8s-training.svc.cluster.local</span></div></div></div></div></div><p>Which will produce a response similar to:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">Server:     </span><span class="token number" style="color:rgb(247, 140, 108)">10.96</span><span class="token plain">.0.10</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Address:    </span><span class="token number" style="color:rgb(247, 140, 108)">10.96</span><span class="token plain">.0.10</span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#53</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Name:    postgresql-svc.k8s-training.svc.cluster.local</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Address: </span><span class="token number" style="color:rgb(247, 140, 108)">172.17</span><span class="token plain">.0.5</span></div></div></div></div></div><p>So the DNS entry has been created and resolves to the IP address of the only Pod inside of the StatefulSet. </p><p>Hence, the headless Service provides a stable network identity for the StatefulSet as the Service couples to the StatefulSet loosely by using a selector in the Service referring to the label <code>app=postgresql-a</code> in the StatefulSet.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="headless-service-for-statefulsets-with-mulitple-replicas"></a>Headless Service for StatefulSets with Mulitple Replicas<a aria-hidden="true" tabindex="-1" class="hash-link" href="#headless-service-for-statefulsets-with-mulitple-replicas" title="Direct link to heading">#</a></h2><p>With a single Pod (<code>replicas: 1</code>) in a StatefulSet the mapping from the headless Service to the Pod is unambiguous: <code>service -&gt; Pod</code>. </p><p>This raises the question <strong>what happens if there are mulitple Pods in the StatefulSet?</strong></p><p>Let&#x27;s try it!</p><p>First, we need a Statefulset with mulitple replicas. So we modify the StatefulSet definition of the previous example by <strong>editing</strong> the file <code>30-stateful-set.yaml</code>.</p><p>Within <code>30-stateful-set.yaml</code> change <code>replicas: 1</code> to <code>replicas: 3</code>. Save the file and apply it:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">kubectl apply -f </span><span class="token number" style="color:rgb(247, 140, 108)">30</span><span class="token plain">-stateful-set.yaml</span></div></div></div></div></div><p>This will update the existing StatefulSet <code>postgresql-sfs</code> and you should see the number of Pods increase from 1 to 3:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">kubectl get statefulsets</span></div></div></div></div></div><p>Of course, <strong>this StatefulSet does not consitute a functioning PostgreSQL cluster</strong> but that&#x27;s alright. All that matters here is the number of Pods to see show the relationship between the number of replicas and the headless Service.</p><p>Now check on the Service again:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">kubectl describe </span><span class="token function" style="color:rgb(130, 170, 255)">service</span><span class="token plain"> postgresql-svc</span></div></div></div></div></div><p>Which should produce an output similar to:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">Name:              postgresql-svc</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Namespace:         k8s-training</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Labels:            </span><span class="token assign-left variable" style="color:rgb(214, 222, 235)">app</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">postgresql-a</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Annotations:       Selector:  </span><span class="token assign-left variable" style="color:rgb(214, 222, 235)">app</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">postgresql-a</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Type:              ClusterIP</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">IP:                None</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Port:              postgresql-port  </span><span class="token number" style="color:rgb(247, 140, 108)">5432</span><span class="token plain">/TCP</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">TargetPort:        </span><span class="token number" style="color:rgb(247, 140, 108)">5432</span><span class="token plain">/TCP</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Endpoints:         </span><span class="token number" style="color:rgb(247, 140, 108)">172.17</span><span class="token plain">.0.5:5432,172.17.0.7:5432,172.17.0.8:5432</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Session Affinity:  None</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Events:            </span><span class="token operator" style="color:rgb(127, 219, 202)">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:rgb(127, 219, 202)">&gt;</span></div></div></div></div></div><p>Pay attention how the <code>Endpoints</code> attribute of the Service has changed without touching the Service explicitly. It now has 3 instead of endpoint: <code>172.17.0.5:5432,172.17.0.7:5432,172.17.0.8:5432</code>.</p><p><strong>So what does the existence of two additional endpoints imply for the DNS configuration</strong>? It means that now the mapping from the Service <code>postgresql-svc</code> ambiguous. It&#x27;s not a 1:1 but a 1:3 mapping. So let&#x27;s figure out what this means by running another utility Pod:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">kubectl run -i --tty nspct --image</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">fischerjulian/nspct --restart</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">Never -- </span><span class="token function" style="color:rgb(130, 170, 255)">bash</span></div></div></div></div></div><p>Within the utility Pod perform another domain lookup:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token function" style="color:rgb(130, 170, 255)">nslookup</span><span class="token plain"> postgresql-svc.k8s-training.svc.cluster.local</span></div></div></div></div></div><p>Which this time will produce:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">Server:     </span><span class="token number" style="color:rgb(247, 140, 108)">10.96</span><span class="token plain">.0.10</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Address:    </span><span class="token number" style="color:rgb(247, 140, 108)">10.96</span><span class="token plain">.0.10</span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#53</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Name:   postgresql-svc.k8s-training.svc.cluster.local</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Address: </span><span class="token number" style="color:rgb(247, 140, 108)">172.17</span><span class="token plain">.0.7</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Name:   postgresql-svc.k8s-training.svc.cluster.local</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Address: </span><span class="token number" style="color:rgb(247, 140, 108)">172.17</span><span class="token plain">.0.5</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Name:   postgresql-svc.k8s-training.svc.cluster.local</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Address: </span><span class="token number" style="color:rgb(247, 140, 108)">172.17</span><span class="token plain">.0.8</span></div></div></div></div></div><p>As you can see all StatefulSet Pods are present in the response.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="links"></a>Links<a aria-hidden="true" tabindex="-1" class="hash-link" href="#links" title="Direct link to heading">#</a></h2><ol><li>PostgreSQL Docker Image at DockerHub, <a href="https://hub.docker.com/_/postgres" target="_blank" rel="noopener noreferrer">https://hub.docker.com/_/postgres</a></li><li>Kubernetes Examples on GitHub, Persistent Volume Provisioning, <a href="https://github.com/kubernetes/examples/blob/master/staging/persistent-volume-provisioning/README.md">https://github.com/kubernetes/examples/blob/master/staging/persistent-volume-provisioning/README.md</a></li><li>PostgreSQL Documentation - psql, <a href="https://www.postgresql.org/docs/12/app-psql.html">https://www.postgresql.org/docs/12/app-psql.html</a></li><li>Kelsey Hightower @ Twitter, <a href="https://twitter.com/kelseyhightower/status/935252923721793536?lang=en" target="_blank" rel="noopener noreferrer">https://twitter.com/kelseyhightower/status/935252923721793536?lang=en</a></li><li>Cloud Foundry, <a href="https://www.cloudfoundry.org/" target="_blank" rel="noopener noreferrer">https://www.cloudfoundry.org/</a></li><li>Open Service Broker API, <a href="https://www.openservicebrokerapi.org/" target="_blank" rel="noopener noreferrer">https://www.openservicebrokerapi.org/</a></li><li>anynines, a9s Data Services, <a href="https://www.anynines.com/data-services" target="_blank" rel="noopener noreferrer">https://www.anynines.com/data-services</a></li><li>Kubernetes Documentation, Concepts, ServiceCatalog, <a href="https://kubernetes.io/docs/concepts/extend-kubernetes/service-catalog/" target="_blank" rel="noopener noreferrer">https://kubernetes.io/docs/concepts/extend-kubernetes/service-catalog/</a></li><li>Wikipedia, Principle of Least Privilege, <a href="https://en.wikipedia.org/wiki/Principle_of_least_privilege" target="_blank" rel="noopener noreferrer">https://en.wikipedia.org/wiki/Principle_of_least_privilege</a></li></ol></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/kubernetes/80-stateful-sets/stateful-set-postgresql"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« PostgreSQL StatefulSet</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/kubernetes/80-stateful-sets/stateful-set-vs-replicasets"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">StatefulSet vs. ReplicaSets »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-statefulset-and-its-headless-service" class="table-of-contents__link">The StatefulSet and its Headless Service</a></li><li><a href="#headless-service-for-statefulsets-with-mulitple-replicas" class="table-of-contents__link">Headless Service for StatefulSets with Mulitple Replicas</a></li><li><a href="#links" class="table-of-contents__link">Links</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">More from anynines</h4><ul class="footer__items"><li class="footer__item"><a href="https://anynines.com/?utm_source=k8s-tutorial&amp;utm_medium=web" target="_blank" rel="noopener noreferrer" class="footer__link-item" to="https://anynines.com/?utm_source=k8s-tutorial&amp;utm_medium=web">anynines.com</a></li><li class="footer__item"><a href="https://paas.anynines.com/?utm_source=k8s-tutorial&amp;utm_medium=web" target="_blank" rel="noopener noreferrer" class="footer__link-item" to="https://paas.anynines.com/?utm_source=k8s-tutorial&amp;utm_medium=web">anynines PaaS</a></li><li class="footer__item"><a href="https://anynines.com/jobs/?utm_source=k8s-tutorial&amp;utm_medium=web" target="_blank" rel="noopener noreferrer" class="footer__link-item" to="https://anynines.com/jobs/?utm_source=k8s-tutorial&amp;utm_medium=web">Jobs at anynines</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Follow us</h4><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/anynines" target="_blank" rel="noopener noreferrer" class="footer__link-item" to="https://twitter.com/anynines">Twitter</a></li><li class="footer__item"><a href="https://www.linkedin.com/company/anynines/" target="_blank" rel="noopener noreferrer" class="footer__link-item" to="https://www.linkedin.com/company/anynines/">LinkedIn</a></li><li class="footer__item"><a href="https://instagram.com/anyninescom" target="_blank" rel="noopener noreferrer" class="footer__link-item" to="https://instagram.com/anyninescom">Instagram</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Legal</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.anynines.com/imprint" target="_blank" rel="noopener noreferrer" class="footer__link-item" to="https://www.anynines.com/imprint">Imprint</a></li><li class="footer__item"><a href="https://www.anynines.com/data-privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item" to="https://www.anynines.com/data-privacy">Privacy Policy</a></li></ul></div></div><div class="text--center"><div>Copyright © 2021 anynines GmbH.</div></div></div></footer></div>
<script src="/styles.3e1a9644.js"></script>
<script src="/runtime~main.4b91e377.js"></script>
<script src="/main.43f40134.js"></script>
<script src="/1.040ff6b2.js"></script>
<script src="/2.9decab9e.js"></script>
<script src="/62.da6d2fa3.js"></script>
<script src="/61.482bd80b.js"></script>
<script src="/ec1ed54d.cede18ae.js"></script>
<script src="/17896441.6d66ffd8.js"></script>
<script src="/0d1ece02.986df59f.js"></script>
</body>
</html>