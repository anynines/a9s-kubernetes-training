<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<title data-react-helmet="true">PSQL Access to PostgreSQL | Kubernetes Training</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://anynines.github.io/a9s-kubernetes-training//img/logo.svg"><meta data-react-helmet="true" name="twitter:image" content="https://anynines.github.io/a9s-kubernetes-training//img/logo.svg"><meta data-react-helmet="true" property="og:url" content="https://anynines.github.io/a9s-kubernetes-training//kubernetes/stateful-sets/stateful-set-psql-access-to-postgresql"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="PSQL Access to PostgreSQL | Kubernetes Training"><meta data-react-helmet="true" name="description" content="Accessing the Database using psql"><meta data-react-helmet="true" property="og:description" content="Accessing the Database using psql"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://anynines.github.io/a9s-kubernetes-training//kubernetes/stateful-sets/stateful-set-psql-access-to-postgresql"><link data-react-helmet="true" rel="alternate" href="https://anynines.github.io/a9s-kubernetes-training//kubernetes/stateful-sets/stateful-set-psql-access-to-postgresql" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://anynines.github.io/a9s-kubernetes-training//kubernetes/stateful-sets/stateful-set-psql-access-to-postgresql" hreflang="x-default"><script data-react-helmet="true" id="oil-configuration" type="application/configuration">
          {
            "config_version": 1,
            "publicPath": "/js",
            "advanced_settings": true,
            "default_to_optin": true,
            "gdpr_applies_globally": true,
            "timeout": -1,
            "local_url": "/oils-de.json",
            "iabVendorListUrl": "/vendorlist.json",
            "customVendorListUrl": "/vendors.json",
          }
        </script><script data-react-helmet="true" src="/oilstub.1.3.5-SNAPSHOT.min.js"></script><script data-react-helmet="true" src="/oil.1.3.5-SNAPSHOT.min.js"></script><link rel="stylesheet" href="/assets/css/styles.2dadb555.css">
<link rel="preload" href="/assets/js/runtime~main.c175611c.js" as="script">
<link rel="preload" href="/assets/js/main.4c268502.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/training-overview"><img src="/img/logo.svg" alt="anynines" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="anynines" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Kubernetes Training</b></a><a class="navbar__item navbar__link" href="/containerization/container-overview">Container Training</a><a class="navbar__item navbar__link" href="/kubernetes/kubernetes-overview">Kubernetes Training</a><a class="navbar__item navbar__link" href="/postgresql/postgresql-overview">PostgreSQL on Kubernetes</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/anynines" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://paas.anynines.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>anynines PaaS<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menuLinkText_1J2g">Introduction</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/training-overview">Kubernetes Training Overview</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menuLinkText_1J2g">Containerization</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/containerization/container-overview">Container Overview</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/containerization/container-intro">Containers Basics</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menuLinkText_1J2g" tabindex="0">Docker</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docker/installation">Docker Installation</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docker/docker-basics">Docker Basics</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docker/creating-images">Creating Container Images</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docker/simple-web-app">Containerizing a Simple Web App</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docker/publish-image">Publishing a Container Image</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docker/container-workflow">The Container Workflow</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docker/docker-cheatsheet">Docker Cheat Sheet</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menuLinkText_1J2g">Kubernetes</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/kubernetes-overview">Kubernetes Overview</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menuLinkText_1J2g" tabindex="0">Basics</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/basics/kubectl">kubectl Basics</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/basics/namespaces">Namespaces</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/basics/container-shell">Container Shell Access</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menuLinkText_1J2g" tabindex="0">Pods</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/pods/introduction">Pods</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menuLinkText_1J2g" tabindex="0">ReplicaSets and Services</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/replicaset-and-service/introduction">ReplicaSets and Services</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/replicaset-and-service/replicasets">ReplicaSets</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/replicaset-and-service/services">Services</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/replicaset-and-service/ingress">Ingress</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/replicaset-and-service/tidyup">Tyding Up</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menuLinkText_1J2g" tabindex="0">Deployments</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/deployments/deployments">Deployments</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menuLinkText_1J2g" tabindex="0">ConfigMaps and Secrets</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/configmaps-and-secrets/configmaps-and-secrets">ConfigMaps and Secrets</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/configmaps-and-secrets/configmaps">ConfigMaps</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/configmaps-and-secrets/exercise-explanation">Exercise Explanation</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/configmaps-and-secrets/configmaps-volume-mounts">ConfigMap Volume Mounts</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/configmaps-and-secrets/secrets">Secrets</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/configmaps-and-secrets/secrets-exercise-explanation">Secrets Exercise Explanation</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menuLinkText_1J2g" tabindex="0">Jobs</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/jobs/jobs">Jobs</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/jobs/advanced-jobs">Advanced Job Features</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/jobs/parallel-jobs">Parallel Jobs</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/jobs/cron-jobs">CronJobs</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menuLinkText_1J2g" tabindex="0">StatefulSets</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/stateful-sets/persistent-volumes">Persistent Volumes</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/stateful-sets/persistent-volumes-exercise">Persistent Volumes Excercise</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/stateful-sets/stateful-sets">StatefulSets</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/stateful-sets/stateful-set-postgresql">PostgreSQL StatefulSet</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/stateful-sets/stateful-set-headless-service">Headless Service</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/stateful-sets/stateful-set-vs-replicasets">StatefulSet vs. ReplicaSets</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/kubernetes/stateful-sets/stateful-set-psql-access-to-postgresql">PSQL Access to PostgreSQL</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/stateful-sets/stateful-set-application-access">Application Access to a StatefulSet</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/stateful-sets/stateful-set-conclusions">Conclusions</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menuLinkText_1J2g">PostgreSQL on Kubernetes</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/postgresql-overview">Overview</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menuLinkText_1J2g" tabindex="0">PostgreSQL Replication</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/postgresql-theory/why-use-replication">Why use Replication?</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/postgresql-theory/replication-outline">Replication Outline</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/postgresql-theory/streaming-replication">PostgreSQL Streaming Replication</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/postgresql-theory/setting-up-streaming-replication">Setting up Streaming Replication</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menuLinkText_1J2g" tabindex="0">StatefulSet with Replication</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/stateful-sets-revisited/stateful-sets-revisited">StatefulSets Revisited</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/building-the-pg-stateful-set/pg-service-primary">Service to Connnect to the Primary</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/building-the-pg-stateful-set/streaming-replication-configmaps">Streaming Replication ConfigMaps</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/building-the-pg-stateful-set/streaming-replication-sfs-init">Initializing the StatefulSet</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/building-the-pg-stateful-set/replication-user">Creating a Replication User</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/building-the-pg-stateful-set/verify-replication">Verifying the Replication</a></li></ul></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/postgresql-outro">Outro</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>PSQL Access to PostgreSQL</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="accessing-the-database-using-psql"></a>Accessing the Database using <code>psql</code><a class="hash-link" href="#accessing-the-database-using-psql" title="Direct link to heading">#</a></h2><p>After deploying the PostgreSQL server it&#x27;s time to verify whether there&#x27;s actually a database running.</p><p>For the purpose of a brief test it would be nice to have an interactive container running the <code>psql</code> command, the command line tool to access PostgreSQL.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">kubectl run pg-psql -i --tty --image</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">postgres:12.2 --restart</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">Never --env</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;PGPASSWORD=tes6Aev8&quot;</span><span class="token plain"> -- psql -h postgresql-svc.k8s-training.svc.cluster.local -U postgres</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This starts an interactive container (<code>-i --tty</code>) based on the same container image you have used for the database server (<code>postgres:12.2</code>). The container shall never restart (<code>--restart=Never</code>). The container is not started with the default command configured in the container image. Instead, the option <code>-- psql</code> (not the space) replaces the default start command (the PostgreSQL server) with the PostgreSQL command line client. There is no PostgreSQL server running in this container, so that you have to tell <code>psql</code> where to connect and how to authenticate. Noete, that <code>psql</code> read the password from a different environment variable as the container image does for the server. Details on how to use <code>psql</code> can be found in the official PostgreSQL documentation [3]. While it is possible to pass a server host using the <code>-h</code> option as well as a user using the <code>-U</code> option, the password has to be passed as an environment variable. Among other reasons, this avoids listing the password in a shell history file.</p><p>Have a close look at the DNS name used to connect to the PostgreSQL Kubernetes Service we have created earlier:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">postgresql-svc.k8s-training.svc.cluster.local</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This implies that the internal default URL of your Kubernetes cluster is <code>cluster.local</code> which may be different in other Kubernetes environments. Try to capture the canonical naming scheme of the DNS entry:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token operator" style="color:rgb(127, 219, 202)">&lt;</span><span class="token plain">service-name</span><span class="token operator" style="color:rgb(127, 219, 202)">&gt;</span><span class="token plain">.</span><span class="token operator" style="color:rgb(127, 219, 202)">&lt;</span><span class="token plain">namespace</span><span class="token operator" style="color:rgb(127, 219, 202)">&gt;</span><span class="token plain">.svc.</span><span class="token operator" style="color:rgb(127, 219, 202)">&lt;</span><span class="token plain">internal-cluster-default-domain</span><span class="token operator" style="color:rgb(127, 219, 202)">&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Remember this pattern as it allows you to build your own ad-hoc host-names and throw-away access containers for testing purposes like this.</p><p>After creating the container you should see a promt. Type <code>\l</code> and you should see a list of databases:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token assign-left variable" style="color:rgb(214, 222, 235)">postgres</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># \l</span><span class="token plain"></span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">                                List of databases</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  Name    </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain">  Owner   </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain"> Encoding </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain">  Collate   </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain">   Ctype    </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain">   Access privileges</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">-----------+----------+----------+------------+------------+-----------------------</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">postgres  </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain"> postgres </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain"> UTF8     </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain"> en_US.utf8 </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain"> en_US.utf8 </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain"></span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">template0 </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain"> postgres </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain"> UTF8     </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain"> en_US.utf8 </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain"> en_US.utf8 </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">c/postgres          +</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">          </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain">          </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain">          </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain">            </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain">            </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(214, 222, 235)">postgres</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">CTc/postgres</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">template1 </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain"> postgres </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain"> UTF8     </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain"> en_US.utf8 </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain"> en_US.utf8 </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">c/postgres          +</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">          </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain">          </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain">          </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain">            </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain">            </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(214, 222, 235)">postgres</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">CTc/postgres</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"> rows</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(214, 222, 235)">postgres</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="write-to-the-database"></a>Write to the Database<a class="hash-link" href="#write-to-the-database" title="Direct link to heading">#</a></h3><p>While still being in the <code>psql</code> terminal select the <code>postgresql</code> database by typing <code>\c</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token assign-left variable" style="color:rgb(214, 222, 235)">postgres</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># \c postgres;</span><span class="token plain"></span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">You are now connected to database </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;postgres&quot;</span><span class="token plain"> as user </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;postgres&quot;</span><span class="token builtin class-name" style="color:rgb(255, 203, 139)">.</span><span class="token plain"></span></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(214, 222, 235)">postgres</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Let&#x27;s create a table by pasting the following SQL command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">CREATE TABLE COMPANY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  ID INT PRIMARY KEY     NOT NULL,</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  NAME           TEXT    NOT NULL</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>And also a first record:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">INSERT INTO COMPANY </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ID, NAME</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> VALUES </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">, </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;anynines GmbH&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Type <code>\q</code> to quit <code>psql</code> and terminate the Pod.</p><p>Delete the Pod:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">kubectl delete pod pg-psql</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Now your database still exists.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="disturbing-the-statefulset"></a>Disturbing the StatefulSet<a class="hash-link" href="#disturbing-the-statefulset" title="Direct link to heading">#</a></h2><p>As shown earlier, a StatefulSet is more than just a (collection of) Pods. There is a StatefulSet Controller watching your Pods like guardian angel. Now that we have data in our PostgreSQL instance, let&#x27;s put the guardian angel to another test.</p><p>Obtain the name of the StatefulSet&#x27;s Pod:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">kubectl get pods -l </span><span class="token assign-left variable" style="color:rgb(214, 222, 235)">app</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">postgresql-a</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Now, simulate the failure of a Pod by destroying it:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">kubectl delete pod postgresql-sfs-0</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>And watch what happens - but be fast as the show is over quickly:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">kubectl get pods -l </span><span class="token assign-left variable" style="color:rgb(214, 222, 235)">app</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">postgresql-a -w</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You should first see that the container is creating again:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">NAME               READY   STATUS              RESTARTS   AGE</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">postgresql-sfs-0   </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">/1     ContainerCreating   </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">          0s</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>And soon after that it has been fully recovered:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">NAME               READY   STATUS    RESTARTS   AGE</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">postgresql-sfs-0   </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">          35s</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Now </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">kubectl run pg-psql -i --tty --image</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">postgres:12.2 --restart</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">Never --env</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;PGPASSWORD=tes6Aev8&quot;</span><span class="token plain"> -- psql -h postgresql-svc.k8s-training.svc.cluster.local -U postgres</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>And in Â´psql`:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain">c postgres</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">SELECT * FROM COMPANIES</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You should see:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token assign-left variable" style="color:rgb(214, 222, 235)">postgres</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># SELECT * FROM COMPANY;</span><span class="token plain"></span></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">id</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain">     name</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">----+---------------</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain"> anynines GmbH</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Which means that the data stored in the PostgreSQL container has surved the failure of it&#x27;s Pod although the Pod itself is stateless. This is possible as you have mounted the data directory of PostgreSQL to the mounted Persistent Volume whose lifecycle goes beyond that of a Pod. When you manually deleted the Pod, <strong>the actual state of the StatefulSet</strong> has been changed and caused a deviation from <strong>the desired state of the StatefulSet</strong>. This deviation has been noticed by the StatefulSet controller which has then taken corrective measures and told the Kubernetes system to create another Pod - with the same identity and the mounting the same Persistent Volume. <strong>Welcome to the world of declarative configuration</strong>! The description of the StatefulSet is declarative as a user declares how the StatefulSet should look like rather than that Kubernetes should create a Pod and a Persistent Volume. The StatefulSet controller is put in charge of taking all actions necessary to ensure a minimum deviation from the desired state. <strong>This way your database gets self-healing capabilities with a disaster recovery time of a few seconds</strong>!</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="links"></a>Links<a class="hash-link" href="#links" title="Direct link to heading">#</a></h2><ol><li>PostgreSQL Docker Image at DockerHub, <a href="https://hub.docker.com/_/postgres" target="_blank" rel="noopener noreferrer">https://hub.docker.com/_/postgres</a></li><li>Kubernetes Examples on GitHub, Persistent Volume Provisioning, <a href="https://github.com/kubernetes/examples/blob/master/staging/persistent-volume-provisioning/README.md" target="_blank" rel="noopener noreferrer">https://github.com/kubernetes/examples/blob/master/staging/persistent-volume-provisioning/README.md</a></li><li>PostgreSQL Documentation - psql, <a href="https://www.postgresql.org/docs/12/app-psql.html" target="_blank" rel="noopener noreferrer">https://www.postgresql.org/docs/12/app-psql.html</a></li><li>Kelsey Hightower @ Twitter, <a href="https://twitter.com/kelseyhightower/status/935252923721793536?lang=en" target="_blank" rel="noopener noreferrer">https://twitter.com/kelseyhightower/status/935252923721793536?lang=en</a></li><li>Cloud Foundry, <a href="https://www.cloudfoundry.org/" target="_blank" rel="noopener noreferrer">https://www.cloudfoundry.org/</a></li><li>Open Service Broker API, <a href="https://www.openservicebrokerapi.org/" target="_blank" rel="noopener noreferrer">https://www.openservicebrokerapi.org/</a></li><li>anynines, a9s Data Services, <a href="https://www.anynines.com/data-services" target="_blank" rel="noopener noreferrer">https://www.anynines.com/data-services</a></li><li>Kubernetes Documentation, Concepts, ServiceCatalog, <a href="https://kubernetes.io/docs/concepts/extend-kubernetes/service-catalog/" target="_blank" rel="noopener noreferrer">https://kubernetes.io/docs/concepts/extend-kubernetes/service-catalog/</a></li><li>Wikipedia, Principle of Least Privilege, <a href="https://en.wikipedia.org/wiki/Principle_of_least_privilege" target="_blank" rel="noopener noreferrer">https://en.wikipedia.org/wiki/Principle_of_least_privilege</a></li></ol></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/kubernetes/stateful-sets/stateful-set-vs-replicasets"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« StatefulSet vs. ReplicaSets</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/kubernetes/stateful-sets/stateful-set-application-access"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Application Access to a StatefulSet Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#accessing-the-database-using-psql" class="table-of-contents__link">Accessing the Database using <code>psql</code></a><ul><li><a href="#write-to-the-database" class="table-of-contents__link">Write to the Database</a></li></ul></li><li><a href="#disturbing-the-statefulset" class="table-of-contents__link">Disturbing the StatefulSet</a></li><li><a href="#links" class="table-of-contents__link">Links</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">More from anynines</h4><ul class="footer__items"><li class="footer__item"><a href="https://anynines.com/?utm_source=k8s-tutorial&amp;utm_medium=web" target="_blank" rel="noopener noreferrer" class="footer__link-item">anynines.com</a></li><li class="footer__item"><a href="https://paas.anynines.com/?utm_source=k8s-tutorial&amp;utm_medium=web" target="_blank" rel="noopener noreferrer" class="footer__link-item">anynines PaaS</a></li><li class="footer__item"><a href="https://anynines.com/jobs/?utm_source=k8s-tutorial&amp;utm_medium=web" target="_blank" rel="noopener noreferrer" class="footer__link-item">Jobs at anynines</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Follow us</h4><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/anynines" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://www.linkedin.com/company/anynines/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn</a></li><li class="footer__item"><a href="https://instagram.com/anyninescom" target="_blank" rel="noopener noreferrer" class="footer__link-item">Instagram</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Legal</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.anynines.com/imprint" target="_blank" rel="noopener noreferrer" class="footer__link-item">Imprint</a></li><li class="footer__item"><a href="https://www.anynines.com/data-privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy Policy</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2021 anynines GmbH.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.c175611c.js"></script>
<script src="/assets/js/main.4c268502.js"></script>
</body>
</html>