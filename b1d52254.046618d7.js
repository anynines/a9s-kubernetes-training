(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{127:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return r})),t.d(n,"metadata",(function(){return c})),t.d(n,"rightToc",(function(){return s})),t.d(n,"default",(function(){return p}));var o=t(1),a=t(6),i=(t(0),t(138)),r={id:"configmaps-volume-mounts",title:"ConfigMap Volume Mounts"},c={id:"kubernetes/60-configmaps-and-secrets/configmaps-volume-mounts",title:"ConfigMap Volume Mounts",description:"In the past lesson you have learned how to map ConfigMaps to environment variables. While this is a valid approach to separate configuration information from application source code, it comes with a slight drawback. ",source:"@site/docs/kubernetes/60-configmaps-and-secrets/60-configmap-volume-mounts.md",permalink:"/kubernetes/60-configmaps-and-secrets/configmaps-volume-mounts",sidebar:"docs",previous:{title:"Exercise Explanation",permalink:"/kubernetes/60-configmaps-and-secrets/exercise-explanation"},next:{title:"Secrets",permalink:"/kubernetes/60-configmaps-and-secrets/secrets"}},s=[{value:"Exercise",id:"exercise",children:[]}],l={rightToc:s};function p(e){var n=e.components,t=Object(a.a)(e,["components"]);return Object(i.b)("wrapper",Object(o.a)({},l,t,{components:n,mdxType:"MDXLayout"}),Object(i.b)("p",null,"In the past lesson you have learned how to map ConfigMaps to environment variables. While this is a valid approach to separate configuration information from application source code, it comes with a slight drawback. "),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Environment variables are injected into a Pod during its creation and therefore changes to a ConfigMap won't be reflected during the Pod's lifetime. In other words, to update the ConfigMaps of a Pod, the Pod has to be restarted.")),Object(i.b)("p",null,"Alternatively, Kubernetes allows ",Object(i.b)("strong",{parentName:"p"},"file based access to ConfigMaps"),". With this approach ",Object(i.b)("strong",{parentName:"p"},"a ConfigMap is mounted as a volume into a Pod. In case the ConfigMap is updated, changes are reflected immediately in the files of the ConfigMap volume.")," Up to this point there is no notification from Kubernetes telling the application actively about a ConfigMap update. It therefore is ",Object(i.b)("strong",{parentName:"p"},"the responsibility of the application to observe ConfigMap files for changes")," and handle them accordingly."),Object(i.b)("p",null,"Have a look at the Pod definition in the file ",Object(i.b)("inlineCode",{parentName:"p"},"70-pod-with-config-map-volume.yaml"),":"),Object(i.b)("pre",null,Object(i.b)("code",Object(o.a)({parentName:"pre"},{className:"language-YAML"}),'apiVersion: v1\nkind: Pod\nmetadata:\n  name: busybox-config\nspec:\n  containers:\n    - image: busybox \n      name: busybox-config-container\n      command:\n        - "sh"\n        - "-c"        \n      args:   \n        - "ls /config; cat /config/number-of-requests; echo \\" \\"; cat /config/very-important-switch"             \n      volumeMounts:\n        - name: config-volume\n          mountPath: /config\n  volumes:\n    - name: config-volume\n      configMap:\n        name: config-example-2\n  restartPolicy: Never\n')),Object(i.b)("p",null,"The Pod definition in ",Object(i.b)("inlineCode",{parentName:"p"},"70-pod-with-config-map-volume.yaml")," uses ",Object(i.b)("inlineCode",{parentName:"p"},"sh -c")," as the container command to then execute several shell commands passed as arguments. Generally speaking, containers should have a single responsibility and thus invoking a single command should suffice. In this case of a one-off Pod building a container image would be wasteful so that the trick comes in handy."),Object(i.b)("p",null,"Also worth recognizing is that the volume is defined at the Pod level but mounted at the container level. You can see this by looking at the indentation level where ",Object(i.b)("inlineCode",{parentName:"p"},"volumes")," is on the same level as ",Object(i.b)("inlineCode",{parentName:"p"},"spec")," but ",Object(i.b)("inlineCode",{parentName:"p"},"volumeMounts")," is located under the ",Object(i.b)("inlineCode",{parentName:"p"},"busybox-confi")," container in the ",Object(i.b)("inlineCode",{parentName:"p"},"containers")," section. This means that a volume can be shared among containers of the same Pod."),Object(i.b)("p",null,"Execute the Pod definition:"),Object(i.b)("pre",null,Object(i.b)("code",Object(o.a)({parentName:"pre"},{}),"kubectl apply -f 70-pod-with-config-map-volume.yaml\n")),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"ls /config")," command will print to STDOUT and the output can be gathered as logs:"),Object(i.b)("pre",null,Object(i.b)("code",Object(o.a)({parentName:"pre"},{}),"kubectl logs busybox-config\n")),Object(i.b)("p",null,"The log output should be:"),Object(i.b)("pre",null,Object(i.b)("code",Object(o.a)({parentName:"pre"},{}),"number-of-requests\nvery-important-switch\n20\ntrue\n")),Object(i.b)("p",null,"As the log-output shows the ConfigMap keys are represented as files in the ConfigMap volume. Their contents are the ConfigMap values associated with the corresponding keys. Pretty straightforward."),Object(i.b)("h2",{id:"exercise"},"Exercise"),Object(i.b)("p",null,"If ConfigMap keys become files and ConfigMap values are the contents of these files, the earlier ConfigMap example ",Object(i.b)("inlineCode",{parentName:"p"},"config-example-1")," comes to mind. In this ConfigMap the key ",Object(i.b)("inlineCode",{parentName:"p"},"20-config-file.conf")," was created after importing a config file converting into a ConfigMap."),Object(i.b)("p",null,"Modify the Pod definition from the previous example to mount the config file contained in the ConfigMap and write its contents to the log (like before)."),Object(i.b)("p",null,'Can you see how importing the config file goes together with mounting the ConfigMap as a volume? From the container perspective it the config file "feels" like any other config file.'))}p.isMDXComponent=!0},138:function(e,n,t){"use strict";t.d(n,"a",(function(){return u})),t.d(n,"b",(function(){return b}));var o=t(0),a=t.n(o);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function c(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,o,a=function(e,n){if(null==e)return{};var t,o,a={},i=Object.keys(e);for(o=0;o<i.length;o++)t=i[o],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)t=i[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var l=a.a.createContext({}),p=function(e){var n=a.a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):c({},n,{},e)),t},u=function(e){var n=p(e.components);return a.a.createElement(l.Provider,{value:n},e.children)},f={inlineCode:"code",wrapper:function(e){var n=e.children;return a.a.createElement(a.a.Fragment,{},n)}},m=Object(o.forwardRef)((function(e,n){var t=e.components,o=e.mdxType,i=e.originalType,r=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),u=p(t),m=o,b=u["".concat(r,".").concat(m)]||u[m]||f[m]||i;return t?a.a.createElement(b,c({ref:n},l,{components:t})):a.a.createElement(b,c({ref:n},l))}));function b(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var i=t.length,r=new Array(i);r[0]=m;var c={};for(var s in n)hasOwnProperty.call(n,s)&&(c[s]=n[s]);c.originalType=e,c.mdxType="string"==typeof e?e:o,r[1]=c;for(var l=2;l<i;l++)r[l]=t[l];return a.a.createElement.apply(null,r)}return a.a.createElement.apply(null,t)}m.displayName="MDXCreateElement"}}]);