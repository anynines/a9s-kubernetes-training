<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus">


<title data-react-helmet="true">ReplicaSets | Kubernetes Training</title>

<meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"><meta data-react-helmet="true" property="og:title" content="Kubernetes Training"><meta data-react-helmet="true" property="og:image" content="https://anynines.github.io/img/logo.svg"><meta data-react-helmet="true" property="twitter:image" content="https://anynines.github.io/img/logo.svg"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for Kubernetes Training"><meta data-react-helmet="true" name="twitter:card" content="summary"><meta data-react-helmet="true" name="description" content="This lesson covers how to run a stateless app in Kubernets using a Replica Set."><meta data-react-helmet="true" property="og:description" content="This lesson covers how to run a stateless app in Kubernets using a Replica Set."><meta data-react-helmet="true" property="og:url" content="https://anynines.github.io/docs/kubernetes/40-replicaset-and-service/replicasets">

<link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico">


<link rel="stylesheet" href="/styles.02746a95.css">


<link rel="preload" href="/styles.cd22f2db.js" as="script">

<link rel="preload" href="/runtime~main.09709d68.js" as="script">

<link rel="preload" href="/main.d8745fdf.js" as="script">

<link rel="preload" href="/1.78db2c66.js" as="script">

<link rel="preload" href="/1be78505.c6a04302.js" as="script">

<link rel="preload" href="/38.ba61ca52.js" as="script">

<link rel="preload" href="/20ac7829.fb74b8e2.js" as="script">

<link rel="preload" href="/17896441.fa0e84b7.js" as="script">

<link rel="preload" href="/470d3280.4e755ef2.js" as="script">

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="anynines"><strong class="navbar__title">Kubernetes Training</strong></a><a class="navbar__item navbar__link" href="/docs/containerization/container-overview">Container Training</a><a class="navbar__item navbar__link" href="/docs/kubernetes/kubernetes-overview">Kubernetes Training</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://github.com/anynines">GitHub</a><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://paas.anynines.com">anynines PaaS</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="anynines"><strong class="navbar__title">Kubernetes Training</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/containerization/container-overview">Container Training</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/kubernetes/kubernetes-overview">Kubernetes Training</a></li><li class="menu__list-item"><a class="menu__link" target="_blank" rel="noopener noreferrer" href="https://github.com/anynines">GitHub</a></li><li class="menu__list-item"><a class="menu__link" target="_blank" rel="noopener noreferrer" href="https://paas.anynines.com">anynines PaaS</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="sidebarLogo_3ono"><img src="/img/logo.svg" alt="anynines"><strong>Kubernetes Training</strong></div><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="#!">Introduction</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/training-overview">Kubernetes Training Overview</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="#!">Containerization</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/containerization/container-overview">Container Overview</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/containerization/container-intro">Containers Basics</a></li><li class="menu__list-item"><a class="menu__link" href="#!">Docker</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/docker/installation">Docker Installation</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/docker/docker-basics">Docker Basics</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/docker/creating-images">Creating Container Images</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/docker/simple-web-app">Containerizing a Simple Web App</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/docker/publish-image">Publishing a Container Image</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/docker/container-workflow">The Container Workflow</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/docker/docker-cheatsheet">Docker Cheat Sheet</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link" href="#!">Kubernetes</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/kubernetes/kubernetes-overview">Kubernetes Overview</a></li><li class="menu__list-item"><a class="menu__link" href="#!">Basics</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/kubernetes/10-basics/kubectl">kubectl Basics</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/kubernetes/10-basics/namespaces">Namespaces</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/kubernetes/10-basics/container-shell">Container Shell Access</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="#!">Pods</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/kubernetes/20-pods/introduction">Pods</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="#!">ReplicaSets and Services</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/kubernetes/40-replicaset-and-service/introduction">ReplicaSets and Services</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/docs/kubernetes/40-replicaset-and-service/replicasets">ReplicaSets</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/kubernetes/40-replicaset-and-service/services">Services</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/kubernetes/40-replicaset-and-service/ingress">Ingress</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/kubernetes/40-replicaset-and-service/tidyup">Tyding Up</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="#!">Deployments</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/kubernetes/50-deployments/deployments">Deployments</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="#!">ConfigMaps and Secrets</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/kubernetes/60-configmaps-and-secrets/configmaps-and-secrets">ConfigMaps and Secrets</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/kubernetes/60-configmaps-and-secrets/configmaps">ConfigMaps</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/kubernetes/60-configmaps-and-secrets/exercise-explanation">Exercise Explanation</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/kubernetes/60-configmaps-and-secrets/configmaps-volume-mounts">ConfigMap Volume Mounts</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/kubernetes/60-configmaps-and-secrets/secrets">Secrets</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/kubernetes/60-configmaps-and-secrets/secrets-exercise-explanation">Secrets Exercise Explanation</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="#!">Jobs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/kubernetes/70-jobs/jobs">Jobs</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/kubernetes/70-jobs/advanced-jobs">Advanced Job Features</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/kubernetes/70-jobs/parallel-jobs">Parallel Jobs</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/kubernetes/70-jobs/cron-jobs">CronJobs</a></li></ul></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="padding-vert--lg"><div class="container"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">ReplicaSets</h1></header><div class="markdown"><p> This lesson covers how to run a stateless app in Kubernets using a Replica Set.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="hello-world-web-app"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#hello-world-web-app" title="Direct link to heading">#</a>Hello World Web App</h2><p>The sample application can be found on github: <a href="https://github.com/fischerjulian/smpl-go-web">https://github.com/fischerjulian/smpl-go-web</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="creating-the-replicaset"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#creating-the-replicaset" title="Direct link to heading">#</a>Creating the ReplicaSet</h2><p>In order to creating the ReplicaSet using <code>kubectl</code> create a file <code>20-rs-hello-world.yaml</code>:</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-YAML codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: apps/v1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kind: ReplicaSet</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name: smpl-go-web-rs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  labels:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      app: smpl-go-web-a</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      tier: fontend</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">spec:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  replicas: 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  selector:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    matchLabels:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      tier: fontend</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  template:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    metadata:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      labels:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        app: smpl-go-web-a</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        version: &quot;1&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        tier: fontend  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    spec:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      containers:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        - name: smpl-go-web-c</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          image: &quot;fischerjulian/smpl-go-web:1.0.0&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          ports:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            - containerPort: 8080</span></div></code></pre></div><p>And apply it:</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-undefined codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl apply -f 20-rs-hello-world.yaml</span></div></code></pre></div><p>This creates a Pod with a single container running a hello world application.
Verify that the Pods has been created successfully:</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-undefined codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl get pods</span></div></code></pre></div><p>You should see a running pod names something like <code>smpl-go-web-rs-pkqwd</code> where the last part is a random string which will be different for every instance of the replica set.</p><p>In case you seen the <em>status</em> <code>ContainerCreating</code> you can use:</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-undefined codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl get pods --watch </span></div></code></pre></div><p>To observe the current Pod state until completion.</p><p>Now the application is deployed. However, it can only be accessed from within the cluster.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="exercise-access-the-sample-web-app-from-withing-the-cluster"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#exercise-access-the-sample-web-app-from-withing-the-cluster" title="Direct link to heading">#</a>Exercise: Access the Sample Web App from Withing the Cluster</h2><p>A straight forward way to access the web app is to directly access the corresponding Pod:</p><ul><li>Run <code>kubectl describe pod smpl-go-web-rs-pkqwd</code> (replace <em>pkqwd</em> with your Pod&#x27;s suffix) and extract the IP address of the <code>smpl-go-web-rs-pkqwd</code>-Pod, e.g. 100.96.14.17</li><li>Start a container running a shell as described in one of the previous lessons.</li><li>Inside the interactive container use the wget command to access the Pod, e.g. <code>wget 100.96.14.17:8080</code>. You can read the returned file using the cat command: <code>cat index.html</code>.</li><li>Don&#x27;t forget to delete the interactive busybox Pod after using it: <code>kubectl delete pod busybox</code></li></ul><p>However, this approach comes with some signficant disadvantages. Possible the biggest drawback is the a client trying accessing the app needs to figure out where the Pod is located by obtaining it&#x27;s IP address. This process is also referred to as <em>service discovery</em>. Once, the IP address is known, the client can access the Pod but what happens if the Pod failes, e.g. caused by the failure or maintenance of the underlying Kubernetes Node (the VM the Pod is running on)? In this case the ReplicaSet will be rescheduled by Kubernetes and most likely receive a different IP address. The resulting <em>service discovery</em>-challenge is non trivial in a dynamic cluster environment.</p><p>Kubernetes provides the concept of a <code>Service</code> enabling a number of ways to deal with <em>service discovery</em>, gracefully.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="pods-and-ports"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#pods-and-ports" title="Direct link to heading">#</a>Pods and Ports</h2><p>Have you noticed that the container specification of the app contains an explicit port declaration?</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-undefined codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">spec:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  containers:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - name: smpl-go-web-c</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      image: &quot;fischerjulian/smpl-go-web:1.0.0&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ports:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        - containerPort: 8080</span></div></code></pre></div><p>The Kubernetes documentation says: </p><blockquote><p>&quot;Kubernetes gives every pod its own cluster-private IP address, so you do not need to explicitly create links between pods or map container ports to host ports. This means that containers within a Pod can all reach each other’s ports on localhost, and all pods in a cluster can see each other without NAT.&quot;</p></blockquote><p>By owning a private IP address within your cluster network each Pod can use the entire port range (65.535) among its containers. Obviously, this implies that two containers withing a port cannot occupy the same port simultaneously. They may use the same port to communicate but only one container can open it.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="links"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#links" title="Direct link to heading">#</a>Links</h2><ul><li>Kubernetes Documentation, Concepts, ReplicaSet, <a href="https://kubernetes.io/docs/concepts/workloads/controllers/replicaset">https://kubernetes.io/docs/concepts/workloads/controllers/replicaset</a></li><li>Kubernetes v1.12 Documentation, API Reference, ReplicaSet, <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.12/#replicaset-v1-apps">https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.12/#replicaset-v1-apps</a></li></ul></div></article><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/kubernetes/40-replicaset-and-service/introduction"><h5 class="pagination-nav__link--sublabel">Previous</h5><h4 class="pagination-nav__link--label">« ReplicaSets and Services</h4></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/kubernetes/40-replicaset-and-service/services"><h5 class="pagination-nav__link--sublabel">Next</h5><h4 class="pagination-nav__link--label">Services »</h4></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="contents contents__left-border"><li><a href="#hello-world-web-app" class="contents__link">Hello World Web App</a></li><li><a href="#creating-the-replicaset" class="contents__link">Creating the ReplicaSet</a></li><li><a href="#exercise-access-the-sample-web-app-from-withing-the-cluster" class="contents__link">Exercise: Access the Sample Web App from Withing the Cluster</a></li><li><a href="#pods-and-ports" class="contents__link">Pods and Ports</a></li><li><a href="#links" class="contents__link">Links</a></li></ul></div></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="text--center"><div>Copyright © 2020 anynines GmbH.</div></div></div></footer>
</div>

<script src="/styles.cd22f2db.js"></script>

<script src="/runtime~main.09709d68.js"></script>

<script src="/main.d8745fdf.js"></script>

<script src="/1.78db2c66.js"></script>

<script src="/1be78505.c6a04302.js"></script>

<script src="/38.ba61ca52.js"></script>

<script src="/20ac7829.fb74b8e2.js"></script>

<script src="/17896441.fa0e84b7.js"></script>

<script src="/470d3280.4e755ef2.js"></script>


</body>
</html>