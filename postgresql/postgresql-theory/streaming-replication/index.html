<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<title data-react-helmet="true">PostgreSQL Streaming Replication | Kubernetes Training</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://learn.kubernetes.anynines.com/img/logo.svg"><meta data-react-helmet="true" name="twitter:image" content="https://learn.kubernetes.anynines.com/img/logo.svg"><meta data-react-helmet="true" property="og:url" content="https://learn.kubernetes.anynines.com/postgresql/postgresql-theory/streaming-replication"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="PostgreSQL Streaming Replication | Kubernetes Training"><meta data-react-helmet="true" name="description" content="Before setting up an asynchronously replicating PostgreSQL it makes sense to understand which replication method is used and - roughly - how it works."><meta data-react-helmet="true" property="og:description" content="Before setting up an asynchronously replicating PostgreSQL it makes sense to understand which replication method is used and - roughly - how it works."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://learn.kubernetes.anynines.com/postgresql/postgresql-theory/streaming-replication"><link data-react-helmet="true" rel="alternate" href="https://learn.kubernetes.anynines.com/postgresql/postgresql-theory/streaming-replication" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://learn.kubernetes.anynines.com/postgresql/postgresql-theory/streaming-replication" hreflang="x-default"><script data-react-helmet="true" id="oil-configuration" type="application/configuration">
          {
            "config_version": 1,
            "publicPath": "/",
            "advanced_settings": true,
            "default_to_optin": true,
            "gdpr_applies_globally": true,
            "timeout": -1,
            "local_url": "/oils-de.json",
            "iabVendorListUrl": "/vendorlist.json",
            "customVendorListUrl": "/vendors.json",
          }
        </script><script data-react-helmet="true" src="/oilstub.1.3.5-SNAPSHOT.min.js"></script><script data-react-helmet="true" src="/oil.1.3.5-SNAPSHOT.min.js"></script><link rel="stylesheet" href="/assets/css/styles.f7ace848.css">
<link rel="preload" href="/assets/js/runtime~main.dc5c9b92.js" as="script">
<link rel="preload" href="/assets/js/main.de5502fe.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/training-overview"><img src="/img/logoLight.svg" alt="anynines" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="anynines" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Kubernetes Training</b></a><a class="navbar__item navbar__link" href="/containerization/container-overview">Container Training</a><a class="navbar__item navbar__link" href="/kubernetes/kubernetes-overview">Kubernetes Training</a><a class="navbar__item navbar__link" href="/postgresql/postgresql-overview">PostgreSQL on Kubernetes</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/anynines/a9s-kubernetes-training" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Fork me<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/anynines" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://paas.anynines.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>anynines PaaS<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Introduction</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Containerization</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Kubernetes</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">PostgreSQL on Kubernetes</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/postgresql-overview">Overview</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">PostgreSQL Replication</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/postgresql-theory/why-use-replication">Why use Replication?</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/postgresql-theory/replication-outline">Replication Outline</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/postgresql/postgresql-theory/streaming-replication">PostgreSQL Streaming Replication</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/postgresql-theory/setting-up-streaming-replication">Setting up Streaming Replication</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">StatefulSet with Replication</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/postgresql-outro">Outro</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>PostgreSQL Streaming Replication</h1></header><p>Before setting up an asynchronously replicating PostgreSQL it makes sense to understand which replication method is used and - roughly - how it works.</p><p><strong>The replication method that will be used is WAL based streaming replication</strong>, but before we jump to this conclusion a brief dive into WAL and Log Shipping will help to understand the choice.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="write-ahead-logging-wal"></a>Write-Ahead Logging (WAL)<a class="hash-link" href="#write-ahead-logging-wal" title="Direct link to heading">#</a></h2><p>Write-Ahead Logging (WAL) is a widely adapted methodology to ensure data integrity while speeding up transactions [2]. This is achieved by writing data changes to an append-only store. Whenever data is changed a WAL file is updated and changes are flushed to the disk. This is much faster than touching and committing several data files to disk as it reduces the number of disk operations.
In case the database server fails before data files have been updated, data can be recovered from the WAL files which contain the missing data changes that have been cached but not applied to the data files, yet.</p><p>As WAL files contain the changes to be applied to data files, they qualify for additional purposes including point in time recovery (PITR) [3] and replication.</p><p>There are at least two different methods to use WALs to accomplish replication: Log Shipping and Streaming Replication.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="asynchronous-replication-using-log-shipping"></a>Asynchronous Replication using Log Shipping<a class="hash-link" href="#asynchronous-replication-using-log-shipping" title="Direct link to heading">#</a></h2><p>In PostgreSQL the write-ahead log is data structure distributed across multiple WAL files of a defined capacity, e.g. 16 MB. One way to establish a replication of a database is to transfer the WAL files to a secondary. This process is called <strong>Log Shipping</strong>.</p><p>This method is asynchronous by design as WAL files can only be transferred after a transaction has been committed.</p><p>The resulting replication lag - data that has been committed but not yet transferred to secondary servers - can be lost in the event of a failing primary server. Streaming replication is a related alternative that can help to further reduce this risk of data loss.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="replication-using-streaming-replication"></a>Replication using Streaming Replication<a class="hash-link" href="#replication-using-streaming-replication" title="Direct link to heading">#</a></h2><p>Instead of waiting for a WAL file to be filled and thus ready to be shipped, streaming replication allows secondaries to connect to the primary server and retrieve WAL records continuously [1]. <strong>With streaming replication WAL records are distributed quicker. Therefore, the replication lag as well as the amount of data at risk decreases</strong>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="summary"></a>Summary<a class="hash-link" href="#summary" title="Direct link to heading">#</a></h2><p>With PostgreSQL asynchronous replication can be implemented using streaming replication of WAL records. This reduces the replication leg to a minimum.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="links"></a>Links<a class="hash-link" href="#links" title="Direct link to heading">#</a></h2><ol><li>PostgreSQL 12 Documentation - Streaming Replication, <a href="https://www.postgresql.org/docs/12/warm-standby.html#STREAMING-REPLICATION" target="_blank" rel="noopener noreferrer">https://www.postgresql.org/docs/12/warm-standby.html#STREAMING-REPLICATION</a></li><li>PostgreSQL 12 Documentation - Write-Ahead Logging (WAL), <a href="https://www.postgresql.org/docs/12/wal-intro.html" target="_blank" rel="noopener noreferrer">https://www.postgresql.org/docs/12/wal-intro.html</a></li><li>PostgreSQL 12 Documentation - Continuous Archiving and Point-in-Time Recovery (PITR), <a href="https://www.postgresql.org/docs/12/continuous-archiving.html" target="_blank" rel="noopener noreferrer">https://www.postgresql.org/docs/12/continuous-archiving.html</a></li><li>PostgreSQL 12 Documentation - Log-Shipping Standby Servers, <a href="https://www.postgresql.org/docs/12/warm-standby.html" target="_blank" rel="noopener noreferrer">https://www.postgresql.org/docs/12/warm-standby.html</a></li></ol></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/postgresql/postgresql-theory/replication-outline"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Replication Outline</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/postgresql/postgresql-theory/setting-up-streaming-replication"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Setting up Streaming Replication Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#write-ahead-logging-wal" class="table-of-contents__link">Write-Ahead Logging (WAL)</a></li><li><a href="#asynchronous-replication-using-log-shipping" class="table-of-contents__link">Asynchronous Replication using Log Shipping</a></li><li><a href="#replication-using-streaming-replication" class="table-of-contents__link">Replication using Streaming Replication</a></li><li><a href="#summary" class="table-of-contents__link">Summary</a></li><li><a href="#links" class="table-of-contents__link">Links</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">More from anynines</h4><ul class="footer__items"><li class="footer__item"><a href="https://anynines.com/?utm_source=k8s-tutorial&amp;utm_medium=web" target="_blank" rel="noopener noreferrer" class="footer__link-item">anynines.com</a></li><li class="footer__item"><a href="https://paas.anynines.com/?utm_source=k8s-tutorial&amp;utm_medium=web" target="_blank" rel="noopener noreferrer" class="footer__link-item">anynines PaaS</a></li><li class="footer__item"><a href="https://anynines.com/jobs/?utm_source=k8s-tutorial&amp;utm_medium=web" target="_blank" rel="noopener noreferrer" class="footer__link-item">Jobs at anynines</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Follow us</h4><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/anynines" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://www.linkedin.com/company/anynines/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn</a></li><li class="footer__item"><a href="https://instagram.com/anyninescom" target="_blank" rel="noopener noreferrer" class="footer__link-item">Instagram</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Legal</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.anynines.com/imprint" target="_blank" rel="noopener noreferrer" class="footer__link-item">Imprint</a></li><li class="footer__item"><a href="https://www.anynines.com/data-privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy Policy</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2023 anynines GmbH.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.dc5c9b92.js"></script>
<script src="/assets/js/main.de5502fe.js"></script>
</body>
</html>