<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.58">
<title data-react-helmet="true">Why use Replication? | Kubernetes Training</title><meta data-react-helmet="true" property="og:image" content="https://anynines.github.io/img/logo.svg"><meta data-react-helmet="true" property="twitter:image" content="https://anynines.github.io/img/logo.svg"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for Kubernetes Training"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Why use Replication? | Kubernetes Training"><meta data-react-helmet="true" name="description" content="In previous chapters of the Kubernetes training a StatefulSet has been developed."><meta data-react-helmet="true" property="og:description" content="In previous chapters of the Kubernetes training a StatefulSet has been developed."><meta data-react-helmet="true" property="og:url" content="https://anynines.github.io/postgresql/20-postgresql-theory/why-use-replication"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://anynines.github.io/postgresql/20-postgresql-theory/why-use-replication"><link rel="stylesheet" href="/styles.3242ed13.css">
<link rel="preload" href="/styles.3e1a9644.js" as="script">
<link rel="preload" href="/runtime~main.1a262263.js" as="script">
<link rel="preload" href="/main.966e7428.js" as="script">
<link rel="preload" href="/1.040ff6b2.js" as="script">
<link rel="preload" href="/2.90b88e03.js" as="script">
<link rel="preload" href="/62.c8c91393.js" as="script">
<link rel="preload" href="/61.9830b7a6.js" as="script">
<link rel="preload" href="/ec1ed54d.cede18ae.js" as="script">
<link rel="preload" href="/17896441.6d66ffd8.js" as="script">
<link rel="preload" href="/effa9e1c.3317ff5f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/training-overview"><img class="navbar__logo" src="/img/logo.svg" alt="anynines"><strong class="navbar__title">Kubernetes Training</strong></a></div><div class="navbar__items navbar__items--right"><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/training-overview"><img class="navbar__logo" src="/img/logo.svg" alt="anynines"><strong class="navbar__title">Kubernetes Training</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp" role="complementary"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLinkText_2sSe">Introduction</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/training-overview">Kubernetes Training Overview</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_2sSe">Containerization</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/containerization/container-overview">Container Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/containerization/container-intro">Containers Basics</a></li><li class="menu__list-item"><a class="menu__link menuLinkText_2sSe" tabindex="0">Docker</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docker/installation">Docker Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docker/docker-basics">Docker Basics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docker/creating-images">Creating Container Images</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docker/simple-web-app">Containerizing a Simple Web App</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docker/publish-image">Publishing a Container Image</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docker/container-workflow">The Container Workflow</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docker/docker-cheatsheet">Docker Cheat Sheet</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_2sSe">Kubernetes</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/kubernetes-overview">Kubernetes Overview</a></li><li class="menu__list-item"><a class="menu__link menuLinkText_2sSe" tabindex="0">Basics</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/10-basics/kubectl">kubectl Basics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/10-basics/namespaces">Namespaces</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/10-basics/container-shell">Container Shell Access</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_2sSe" tabindex="0">Pods</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/20-pods/introduction">Pods</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_2sSe" tabindex="0">ReplicaSets and Services</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/40-replicaset-and-service/introduction">ReplicaSets and Services</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/40-replicaset-and-service/replicasets">ReplicaSets</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/40-replicaset-and-service/services">Services</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/40-replicaset-and-service/ingress">Ingress</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/40-replicaset-and-service/tidyup">Tyding Up</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_2sSe" tabindex="0">Deployments</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/50-deployments/deployments">Deployments</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_2sSe" tabindex="0">ConfigMaps and Secrets</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/60-configmaps-and-secrets/configmaps-and-secrets">ConfigMaps and Secrets</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/60-configmaps-and-secrets/configmaps">ConfigMaps</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/60-configmaps-and-secrets/exercise-explanation">Exercise Explanation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/60-configmaps-and-secrets/configmaps-volume-mounts">ConfigMap Volume Mounts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/60-configmaps-and-secrets/secrets">Secrets</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/60-configmaps-and-secrets/secrets-exercise-explanation">Secrets Exercise Explanation</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_2sSe" tabindex="0">Jobs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/70-jobs/jobs">Jobs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/70-jobs/advanced-jobs">Advanced Job Features</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/70-jobs/parallel-jobs">Parallel Jobs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/70-jobs/cron-jobs">CronJobs</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_2sSe" tabindex="0">StatefulSets</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/80-stateful-sets/persistent-volumes">Persistent Volumes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/80-stateful-sets/persistent-volumes-exercise">Persistent Volumes Excercise</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/80-stateful-sets/stateful-sets">StatefulSets</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/80-stateful-sets/stateful-set-postgresql">PostgreSQL StatefulSet</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/80-stateful-sets/stateful-set-headless-service">Headless Service</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/80-stateful-sets/stateful-set-vs-replicasets">StatefulSet vs. ReplicaSets</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/80-stateful-sets/stateful-set-psql-access-to-postgresql">PSQL Access to PostgreSQL</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/80-stateful-sets/stateful-set-application-access">Application Access to a StatefulSet</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes/80-stateful-sets/stateful-set-conclusions">Conclusions</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_2sSe">PostgreSQL on Kubernetes</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/postgresql-overview">Overview</a></li><li class="menu__list-item"><a class="menu__link menuLinkText_2sSe" tabindex="0">PostgreSQL Replication</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/postgresql/20-postgresql-theory/why-use-replication">Why use Replication?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/20-postgresql-theory/replication-outline">Replication Outline</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/20-postgresql-theory/streaming-replication">PostgreSQL Streaming Replication</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/20-postgresql-theory/setting-up-streaming-replication">Setting up Streaming Replication</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_2sSe" tabindex="0">StatefulSet with Replication</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/30-stateful-sets-revisited/stateful-sets-revisited">StatefulSets Revisited</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/40-building-the-pg-stateful-set/pg-service-primary">Service to Connnect to the Primary</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/40-building-the-pg-stateful-set/streaming-replication-configmaps">Streaming Replication ConfigMaps</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/40-building-the-pg-stateful-set/streaming-replication-sfs-init">Initializing the StatefulSet</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/40-building-the-pg-stateful-set/replication-user">Creating a Replication User</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/40-building-the-pg-stateful-set/verify-replication">Verifying the Replication</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/postgresql/postgresql-outro">Outro</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="container padding-vert--lg docItemWrapper_1cc7"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Why use Replication?</h1></header><div class="markdown"><p>In previous chapters of the Kubernetes training a StatefulSet has been developed.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="limitations-of-the-previously-created-postgresql-statefulset"></a>Limitations of the Previously Created PostgreSQL StatefulSet<a aria-hidden="true" tabindex="-1" class="hash-link" href="#limitations-of-the-previously-created-postgresql-statefulset" title="Direct link to heading">#</a></h2><p>This PostgreSQL StatefuSet can provide a single PostgreSQL Pod meaningfully. The single PostgreSQL pod is meaningful as it can be used to store data and can be accessed by application. While it is possible to set the number of <code>replicas</code> to more then <code>1</code> this doesn&#x27;t make sense as there is not replication among the pods of the StatefulSet. Having <code>3</code> unrelated PostgreSQL servers doesn&#x27;t really provide any benefit.</p><p>This leads to two questions:</p><ol><li>Why replicate at all?</li><li>How can replication be configured?</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="why-replicate-at-all"></a>Why Replicate at all?<a aria-hidden="true" tabindex="-1" class="hash-link" href="#why-replicate-at-all" title="Direct link to heading">#</a></h2><p>Experienced database adminstrators may find this question disturbing as a highly available database seem to be impossible without replication. However, there is more to this question than meets the eye.</p><p>Experience shows that in a physical server setup, a failed PostgreSQL has a certain average time to repair (TTR). If hardware needs to be replaced, for example, this may take up to several hours - without the necessary spare parts - even days or weeks. Having a standby-server to failover to is therefore crucial. This will reduce the TTR down to minutes or even seconds.</p><p><strong>With virtual machines on a contemporary infrastructure a separation of the ephemeral VM and it&#x27;s persistent disk has become standard</strong>. With this architectural pattern, the data of a database isn&#x27;t stored on the local disk of a infrastructure host but on a highly available, remotely attached block device. This so called <em>persistent disk</em> or <em>persistent volume</em> separates the lifecycle of the (PostgreSQL) VM from the lifecycle of its (PostgreSQL) data.</p><p>In case of a failed VM, there is no need to wait for hardware to be fixed. With the proper automation, the VM will be rescheduled on a different infrastructure host and the persistent disk will be attached. <strong>The time to repair for such a self-healing scenario lies within several minutes</strong>.</p><p>The motivation to tackle the complexity of replication and cluster management already decreases as the TTR has been drastically reduced by the self-healing automation.</p><p>With Kubernetes and containers this time to repair may shrink even further. Assuming that involved container images are relatively small and/or cached on the Kubernetes nodes, <strong>the self-healing of a failed Pod instead of a failed VM is a matter of seconds rather than minutes</strong>.</p><p>However, this is an oversimplification as <strong>the time to repair may dramatically change</strong> if the failure isn&#x27;t caused by the failure of a single infrastructure host but of the <strong>failure of an entire infrastructure availability zone</strong> or if the <strong>storage server containing the persistent disk has failed</strong>.</p><p>In these cases a recovery from a backup may be necessary which implies a corresponding <strong>data loss</strong>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="summary"></a>Summary<a aria-hidden="true" tabindex="-1" class="hash-link" href="#summary" title="Direct link to heading">#</a></h2><p>In order to allow a fast failover and reduce to the potential data loss to a minum, <strong>replication can be used to keep spare standby servers across availability zones</strong>. For most infrastructures, this also implies using disjunct storage servers.</p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/postgresql/postgresql-overview"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Overview</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/postgresql/20-postgresql-theory/replication-outline"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Replication Outline »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#limitations-of-the-previously-created-postgresql-statefulset" class="table-of-contents__link">Limitations of the Previously Created PostgreSQL StatefulSet</a></li><li><a href="#why-replicate-at-all" class="table-of-contents__link">Why Replicate at all?</a></li><li><a href="#summary" class="table-of-contents__link">Summary</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">More from anynines</h4><ul class="footer__items"><li class="footer__item"><a href="https://anynines.com/?utm_source=k8s-tutorial&amp;utm_medium=web" target="_blank" rel="noopener noreferrer" class="footer__link-item" to="https://anynines.com/?utm_source=k8s-tutorial&amp;utm_medium=web">anynines.com</a></li><li class="footer__item"><a href="https://paas.anynines.com/?utm_source=k8s-tutorial&amp;utm_medium=web" target="_blank" rel="noopener noreferrer" class="footer__link-item" to="https://paas.anynines.com/?utm_source=k8s-tutorial&amp;utm_medium=web">anynines PaaS</a></li><li class="footer__item"><a href="https://anynines.com/jobs/?utm_source=k8s-tutorial&amp;utm_medium=web" target="_blank" rel="noopener noreferrer" class="footer__link-item" to="https://anynines.com/jobs/?utm_source=k8s-tutorial&amp;utm_medium=web">Jobs at anynines</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Follow us</h4><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/anynines" target="_blank" rel="noopener noreferrer" class="footer__link-item" to="https://twitter.com/anynines">Twitter</a></li><li class="footer__item"><a href="https://www.linkedin.com/company/anynines/" target="_blank" rel="noopener noreferrer" class="footer__link-item" to="https://www.linkedin.com/company/anynines/">LinkedIn</a></li><li class="footer__item"><a href="https://instagram.com/anyninescom" target="_blank" rel="noopener noreferrer" class="footer__link-item" to="https://instagram.com/anyninescom">Instagram</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Legal</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.anynines.com/imprint" target="_blank" rel="noopener noreferrer" class="footer__link-item" to="https://www.anynines.com/imprint">Imprint</a></li><li class="footer__item"><a href="https://www.anynines.com/data-privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item" to="https://www.anynines.com/data-privacy">Privacy Policy</a></li></ul></div></div><div class="text--center"><div>Copyright © 2021 anynines GmbH.</div></div></div></footer></div>
<script src="/styles.3e1a9644.js"></script>
<script src="/runtime~main.1a262263.js"></script>
<script src="/main.966e7428.js"></script>
<script src="/1.040ff6b2.js"></script>
<script src="/2.90b88e03.js"></script>
<script src="/62.c8c91393.js"></script>
<script src="/61.9830b7a6.js"></script>
<script src="/ec1ed54d.cede18ae.js"></script>
<script src="/17896441.6d66ffd8.js"></script>
<script src="/effa9e1c.3317ff5f.js"></script>
</body>
</html>