<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<title data-react-helmet="true">Containerizing a Simple Web App | Kubernetes Training</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://learn.kubernetes.anynines.com/img/logo.svg"><meta data-react-helmet="true" name="twitter:image" content="https://learn.kubernetes.anynines.com/img/logo.svg"><meta data-react-helmet="true" property="og:url" content="https://learn.kubernetes.anynines.com/docker/simple-web-app"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Containerizing a Simple Web App | Kubernetes Training"><meta data-react-helmet="true" name="description" content="Related Videos"><meta data-react-helmet="true" property="og:description" content="Related Videos"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://learn.kubernetes.anynines.com/docker/simple-web-app"><link data-react-helmet="true" rel="alternate" href="https://learn.kubernetes.anynines.com/docker/simple-web-app" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://learn.kubernetes.anynines.com/docker/simple-web-app" hreflang="x-default"><script data-react-helmet="true" id="oil-configuration" type="application/configuration">
          {
            "config_version": 1,
            "publicPath": "/",
            "advanced_settings": true,
            "default_to_optin": true,
            "gdpr_applies_globally": true,
            "timeout": -1,
            "local_url": "/oils-de.json",
            "iabVendorListUrl": "/vendorlist.json",
            "customVendorListUrl": "/vendors.json",
          }
        </script><script data-react-helmet="true" src="/oilstub.1.3.5-SNAPSHOT.min.js"></script><script data-react-helmet="true" src="/oil.1.3.5-SNAPSHOT.min.js"></script><link rel="stylesheet" href="/assets/css/styles.f7ace848.css">
<link rel="preload" href="/assets/js/runtime~main.f5a8c1d1.js" as="script">
<link rel="preload" href="/assets/js/main.7e346184.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/training-overview"><img src="/img/logoLight.svg" alt="anynines" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="anynines" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Kubernetes Training</b></a><a class="navbar__item navbar__link" href="/containerization/container-overview">Container Training</a><a class="navbar__item navbar__link" href="/kubernetes/kubernetes-overview">Kubernetes Training</a><a class="navbar__item navbar__link" href="/postgresql/postgresql-overview">PostgreSQL on Kubernetes</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/anynines/a9s-kubernetes-training" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Fork me<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/anynines" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://paas.anynines.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>anynines PaaS<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Introduction</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Containerization</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/containerization/container-overview">Container Overview</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/containerization/container-intro">Containers Basics</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Docker</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docker/installation">Docker Installation</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docker/docker-basics">Docker Basics</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docker/creating-images">Creating Container Images</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docker/simple-web-app">Containerizing a Simple Web App</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docker/publish-image">Publishing a Container Image</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docker/container-workflow">The Container Workflow</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docker/docker-cheatsheet">Docker Cheat Sheet</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Kubernetes</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">PostgreSQL on Kubernetes</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Containerizing a Simple Web App</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="related-videos"></a>Related Videos<a class="hash-link" href="#related-videos" title="Direct link to heading">#</a></h2><div style="padding-top:10px;padding-bottom:1.8em"><style data-emotion="css 1tz8m30">.css-1tz8m30{box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;width:100%;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;margin-top:-32px;width:calc(100% + 32px);margin-left:-32px;}.css-1tz8m30>.MuiGrid-item{padding-top:32px;}.css-1tz8m30>.MuiGrid-item{padding-left:32px;}</style><div class="jss1 MuiGrid-root MuiGrid-container MuiGrid-spacing-xs-4 css-1tz8m30"><style data-emotion="css 1085lws">.css-1085lws{box-sizing:border-box;margin:0;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-flex-basis:100%;-ms-flex-preferred-size:100%;flex-basis:100%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:100%;}@media (min-width:600px){.css-1085lws{-webkit-flex-basis:100%;-ms-flex-preferred-size:100%;flex-basis:100%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:100%;}}@media (min-width:1200px){.css-1085lws{-webkit-flex-basis:33.333333%;-ms-flex-preferred-size:33.333333%;flex-basis:33.333333%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:33.333333%;}}</style><div class="jss1 MuiGrid-root MuiGrid-item MuiGrid-grid-xs-12 MuiGrid-grid-sm-12 MuiGrid-grid-lg-4 css-1085lws"><div style="padding-bottom:56.25%;padding-top:0;position:relative;height:0;border-radius:4px;overflow:hidden;margin-bottom:14px"><iframe class="fadedVideo" style="width:100%;height:100%;top:0;left:0;position:absolute" width="320" src="https://www.youtube-nocookie.com/embed/12c8ziarCqE?rel=0&amp;modestbranding=1&amp;playsinline=0&amp;controls=2" title="YouTube video player" frameborder="0" allow="accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div><style data-emotion="css u7ipk">.css-u7ipk{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.875rem;line-height:1.57;letter-spacing:0.00714em;font-weight:800;}</style><h6 class="jss2 MuiTypography-root MuiTypography-subtitle2 css-u7ipk">Containerizing a Simple Web App</h6></div></div><style data-emotion="css 39bbo6">.css-39bbo6{margin:0;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;border-width:0;border-style:solid;border-color:rgba(0, 0, 0, 0.12);border-bottom-width:thin;}</style><hr class="jss3 MuiDivider-root MuiDivider-fullWidth css-39bbo6" style="padding-top:1.8em"></div><p>In the previous lesson you have created your first container image. This trivial examples has outlined the workflow on how to create a container image.</p><p>In this lesson you will containerize a simple web application to illustrate essential aspects of the <code>Dockerfile</code> notation.</p><p><strong>Go to your training workspace</strong>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token builtin class-name" style="color:rgb(255, 203, 139)">cd</span><span class="token plain"> workspace-ct</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>Create a new container image working directory</strong>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token function" style="color:rgb(130, 170, 255)">mkdir</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">20</span><span class="token plain">-simple-web-app</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 139)">cd</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">20</span><span class="token plain">-simple-web-app</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="the-web-app"></a>The Web App<a class="hash-link" href="#the-web-app" title="Direct link to heading">#</a></h2><p>In order to demonstrate how to build a container image for a web application, obviously a web application is needed.</p><p>It doesn&#x27;t really matter which language or framework is used for this demo as long as it is simplistic and that the code can be understood even if you don&#x27;t know the language nor the the framework well.</p><p>Create a file <code>simple-sinatra-app.rb</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">require </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;sinatra&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">get </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;/&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">do</span><span class="token plain"></span></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;&lt;h1&gt;Hello World!&lt;/h1&gt;&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">end</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>That&#x27;s your web app.</p><p>Optionally and in case you have Ruby [2] installed you could run the app locally by installing the Sinatra gem:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">gem </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> sinatra</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>And then execute:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">ruby simple-sinatra-app.rb</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The app is then running on port <code>4567</code> and can be reached via <code>http://localhost:4567</code>.</p><p><strong>But don&#x27;t exhaust yourself in installing Ruby or trying to run the app, locally</strong>. This is not the focus of the lesson. Instead, proceed with creating a <code>Dockerfile</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="the-dockerfile"></a>The <code>Dockerfile</code><a class="hash-link" href="#the-dockerfile" title="Direct link to heading">#</a></h2><p><strong>Create a new <code>Dockerfile</code></strong>.</p><p>Again we start with a container image specification:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">FROM ruby:2.5-alpine</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">WORKDIR /app</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">RUN gem </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> sinatra</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">COPY simple-sinatra-app.rb /app</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">CMD </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;ruby&quot;</span><span class="token plain">, </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;simple-sinatra-app.rb&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Again, the <code>FROM</code> statement specifies which container image is to be used as the <strong>base image</strong>. Instead, of going through the hassle of setting up a Ruby environment within the container, it is much easier to search for a well-maintained Ruby base image, e.g. on Docker Hub [3]. The <code>ruby:2.5-alpine</code> does the trick. In contrast to the regular <code>ruby:2.5</code> image, the Alpine [4] version is much smaller. You can try it yourself and remove the <code>-alpine</code> at the end of the container image specification and build a container from it. The initial pull will take much longer than the <code>ruby:2.5</code> image - based on the Debian image [5] -, since the latter is much larger.</p><p>Within the container we define a working directory <code>/app</code>.</p><p>Now we face a <strong>challenge: how to get our application into the container</strong>?</p><p>That&#x27;s what the line <code>COPY simple-sinatra-app.rb /app</code> does. It&#x27;s important to understand that the container image during its build interacts with your local filesystem. Copy transfers a file from your local working directory into the container image and thus - later - into the running container.</p><p>The line <code>CMD [&quot;ruby&quot;, &quot;simple-sinatra-app.rb&quot;]</code> starts the application on container startup.</p><p>Now build the container image:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">docker image build -t simple-web-app:0.1.0 </span><span class="token builtin class-name" style="color:rgb(255, 203, 139)">.</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>And run the container:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">docker container run simple-web-app:0.1.0</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You should see the app starting up:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">2020</span><span class="token plain">-03-16 09:38:02</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> INFO  WEBrick </span><span class="token number" style="color:rgb(247, 140, 108)">1.4</span><span class="token plain">.2</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">2020</span><span class="token plain">-03-16 09:38:02</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> INFO  ruby </span><span class="token number" style="color:rgb(247, 140, 108)">2.5</span><span class="token plain">.7 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2019</span><span class="token plain">-10-01</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">x86_64-linux-musl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token operator" style="color:rgb(127, 219, 202)">==</span><span class="token plain"> Sinatra </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">v2.0.8.1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> has taken the stage on </span><span class="token number" style="color:rgb(247, 140, 108)">4567</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">for</span><span class="token plain"> development with backup from WEBrick</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">2020</span><span class="token plain">-03-16 09:38:02</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> INFO  WEBrick::HTTPServer</span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#start: pid=1 port=4567</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>Point your browser to <code>http://localhost:4567</code>. What do you observe?</strong></p><p>It doesn&#x27;t work. But why?</p><p>The reason why it is not working is a <strong>missing port mapping</strong>. The local container using Docker Desktop [7] runs a light-weight virtual machine (VM) or your computer. So your container has been started within a VM. That&#x27;s why a port mapping is necessary. The purpose of the port mapping is to map the container port <code>4567</code> to a local port of your machine.</p><p>So press <code>CTRL+C</code> and stop the existing container. The web app will be shutdown along with the container.</p><p>Although <code>EXPOSE</code> does not perform a port mapping, it is recommended to declare which port is intended to be published. So using <code>EXPOSE</code> is a best practice of the container image author telling the container image user which port may need a port mapping.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">FROM ruby:2.5-alpine</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">WORKDIR /app</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">RUN gem </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> sinatra</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">COPY simple-sinatra-app.rb /app</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">CMD </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;ruby&quot;</span><span class="token plain">, </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;simple-sinatra-app.rb&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">EXPOSE </span><span class="token number" style="color:rgb(247, 140, 108)">4567</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Now, start the container again with a port mapping:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">docker container run -p </span><span class="token number" style="color:rgb(247, 140, 108)">8081</span><span class="token plain">:4567 simple-web-app:0.1.0</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>It still doesn&#x27;t work!</strong> You may ask yourself whether the port mapping wrong, but it isn&#x27;t!</p><p><strong>Exercise</strong>:</p><ol><li>Determine the container ID by using <code>docker container ps</code></li><li>Get shell access into your container with <code>docker container exec -it &lt;container-id&gt; /bin/sh</code>. <strong>Obviously, you have to insert your container ID</strong>.</li><li>Within the container execute <code>wget localhost:4567</code> and <code>cat index.html</code>.</li></ol><p>To your surprise the content of <code>index.html</code> says <code>Hello Container World</code> which means that the app works fine. Which brings us back to the idea that something is wrong with the port mapping. But it still isn&#x27;t! So what is going on?</p><p>Admittedly, there is nothing wrong with neither the container image nor the <code>container run</code> command. In fact, <strong>it&#x27;s an application configuration issue</strong>, but the issue is very common and therefore it makes sense to know about it.</p><p>The current version of our web app binds to the loopback network device [8] referred to by the IP address <code>127.0.0.1</code> inside the container. While you are within the container, e.g. using a shell <code>/bin/sh</code> and issue a command against the loop device such as <code>wget localhost:4567</code> the application responds as you are accessing it through the network device it is bound to.</p><p>If you are inside the container (<code>docker container exec -it &lt;container-id&gt; /bin/sh</code>) and type <code>ifconfig</code> to list existing network devices, you will see:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">/app </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># ifconfig</span><span class="token plain"></span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">eth0      Link encap:Ethernet  HWaddr 02:42:AC:11:00:02</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        inet addr:172.17.0.2  Bcast:172.17.255.255  Mask:255.255.0.0</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        RX packets:28 errors:0 dropped:0 overruns:0 frame:0</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        TX packets:11 errors:0 dropped:0 overruns:0 carrier:0</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        collisions:0 txqueuelen:0</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        RX bytes:2803 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2.7</span><span class="token plain"> KiB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">  TX bytes:961 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">961.0</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">lo        Link encap:Local Loopback</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        inet addr:127.0.0.1  Mask:255.0.0.0</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        UP LOOPBACK RUNNING  MTU:65536  Metric:1</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        RX packets:0 errors:0 dropped:0 overruns:0 frame:0</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        collisions:0 txqueuelen:1000</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        RX bytes:0 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0.0</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">  TX bytes:0 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0.0</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This means that there is the loopback device <code>lo</code> but also the device <code>eth0</code>. No guess which device needs to be used to make the app available for a port mapping. Exactly, <code>eth0</code>.</p><p>In the case of the Sinatra app this can be achieved with a code change. In a production grade web application, this would be implemented as a configuration option but for our example, the code change will suffice.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">require </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;sinatra&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 139)">set</span><span class="token plain"> :bind, </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;0.0.0.0&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">get </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;/&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">do</span><span class="token plain"></span></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;&lt;h1&gt;Hello World!&lt;/h1&gt;&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#d6deeb"><span class="token plain">end</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Binding to the special IP address <code>0.0.0.0</code> is a general way to bind a process to all IP addresses. While this is convenient, it may be dangerous if the machine had a public IP address and binding to it would be unintended. In this case, there are only two network devices and it is ok to bind to both of them, so binding to <code>0.0.0.0</code> is acceptable.</p><p>Create a new container image version <code>0.2.0</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">docker image build -t simple-web-app:0.2.0 </span><span class="token builtin class-name" style="color:rgb(255, 203, 139)">.</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>And run it:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#d6deeb;background-color:#011627"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#d6deeb"><span class="token plain">docker container run -p </span><span class="token number" style="color:rgb(247, 140, 108)">8081</span><span class="token plain">:4567 simple-web-app:0.2.0</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>Point your browser to <code>http://localhost:8081</code>. VoilÃ ! It works!</strong></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="takeaways"></a>Takeaways<a class="hash-link" href="#takeaways" title="Direct link to heading">#</a></h2><p>This section contains a few lessons worth pointing out:</p><ol><li>By using existing images as base images, it is fairly easy to provide the required runtime environment for an application.</li><li>If you want to expose a port, ensure that the process to be exposed is bound to the right network interface and not only to the loopback device.</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="dockerfile-reference"></a><code>Dockerfile</code> Reference<a class="hash-link" href="#dockerfile-reference" title="Direct link to heading">#</a></h2><p>There are many more instructions allowed in a <code>Dockerfile</code>. The Docker documentation contains a Dockerfile Reference section [6] which is worth a read.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="links"></a>Links<a class="hash-link" href="#links" title="Direct link to heading">#</a></h2><ol><li>Computerhope, Linux, Printf, <a href="https://www.computerhope.com/unix/uprintf.htm" target="_blank" rel="noopener noreferrer">https://www.computerhope.com/unix/uprintf.htm</a></li><li>Ruby, <a href="https://www.ruby-lang.org" target="_blank" rel="noopener noreferrer">https://www.ruby-lang.org</a></li><li>Docker Hub, <a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer">https://hub.docker.com/</a></li><li>Alpine Linux, <a href="https://alpinelinux.org/" target="_blank" rel="noopener noreferrer">https://alpinelinux.org/</a></li><li>Debian on Docker Hub, <a href="https://hub.docker.com/_/debian" target="_blank" rel="noopener noreferrer">https://hub.docker.com/_/debian</a></li><li>Docker Documentation, Dockerfile Reference, <a href="https://docs.docker.com/engine/reference/builder/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/engine/reference/builder/</a></li><li>Docker Desktop, <a href="https://www.docker.com/blog/get-to-know-docker-desktop/" target="_blank" rel="noopener noreferrer">https://www.docker.com/blog/get-to-know-docker-desktop/</a></li><li>Wikipedia, Loopback Device, <a href="https://en.wikipedia.org/wiki/Loop_device" target="_blank" rel="noopener noreferrer">https://en.wikipedia.org/wiki/Loop_device</a></li></ol></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docker/creating-images"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Creating Container Images</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docker/publish-image"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Publishing a Container Image Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#related-videos" class="table-of-contents__link">Related Videos</a></li><li><a href="#the-web-app" class="table-of-contents__link">The Web App</a></li><li><a href="#the-dockerfile" class="table-of-contents__link">The <code>Dockerfile</code></a></li><li><a href="#takeaways" class="table-of-contents__link">Takeaways</a></li><li><a href="#dockerfile-reference" class="table-of-contents__link"><code>Dockerfile</code> Reference</a></li><li><a href="#links" class="table-of-contents__link">Links</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">More from anynines</h4><ul class="footer__items"><li class="footer__item"><a href="https://anynines.com/?utm_source=k8s-tutorial&amp;utm_medium=web" target="_blank" rel="noopener noreferrer" class="footer__link-item">anynines.com</a></li><li class="footer__item"><a href="https://paas.anynines.com/?utm_source=k8s-tutorial&amp;utm_medium=web" target="_blank" rel="noopener noreferrer" class="footer__link-item">anynines PaaS</a></li><li class="footer__item"><a href="https://anynines.com/jobs/?utm_source=k8s-tutorial&amp;utm_medium=web" target="_blank" rel="noopener noreferrer" class="footer__link-item">Jobs at anynines</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Follow us</h4><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/anynines" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://www.linkedin.com/company/anynines/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn</a></li><li class="footer__item"><a href="https://instagram.com/anyninescom" target="_blank" rel="noopener noreferrer" class="footer__link-item">Instagram</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Legal</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.anynines.com/imprint" target="_blank" rel="noopener noreferrer" class="footer__link-item">Imprint</a></li><li class="footer__item"><a href="https://www.anynines.com/data-privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy Policy</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2022 anynines GmbH.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.f5a8c1d1.js"></script>
<script src="/assets/js/main.7e346184.js"></script>
</body>
</html>